# 스위치 초보 입문

----------

## 스위치 설명에 들어가기 전에

### 앞으로의 마음가짐

- 기업용 네트워크에서 사용하는 기기에 대해 알아봄
  - 장점과 단점을 중심
  - 개념적인 이해도를 높여

#### 각 기기의 역할을 이해

- 네트워크에서 사용하고 있는 기기의 역할을 모르면 그 기기가 왜 필요한지 알 수 없음

#### 기기의 설정 이해

- 설정을 위해 필요한 것
  - 설정 방법
    - 원래 설계된 컨피그레이션을 기기에 설정하는 방법을 알아야 함
    - 설정 방법은 벤더(판매 대리점)마다 다름
      - 기종마다 다를 수도 있음
  - 컨피그레이션 내용의 이해
    - 설정 방법은 기기별로 다르지만 설정 내용 자체에 크게 틀린 점은 없음
      - 내용의 의미, 즉 근본적인 부분은 같음
    - 설정해야만 하는 값과 그 의미만 알고 있다면 해당 기기의 설정 방법에 맞추면 됨

---------------

## 리피터 허브와 브릿지

- 네트워크는 여러 기기로 구성되어 있어 정확하게 핵심을 담당하는 기기가 무엇인지 꼭 집을 순 없지만 굳이 하나를 선택하자면
스위치(스위칭 허브)라고 할 수 있음
- 1990년대 이전까지는 리피터 허브(라우터를 중심으로 스위치의 시초)가 네트워크를 지지하였으나 2000년대 이후 라우터와 스위치는 네트워크상 중요성이
완전히 바뀜

### CSMA/CD 방식

- 리피터 허브는 PC나 네트워크 기기 등의 단말에서 LAN 케이블을 한곳에 모아 통신 데이터를 중계하기 위한 기기임
- 리피터 허브는 케이블에 데이터를 보내기 위한 규칙으로 CSMA/CD 방식을 채용함
- CSMA/CD(Carrier Sense Multiple Access with Collision Detection)
  - 항상 귀 기울인다 - CS(Carrier Sense)
    - 송신할 데이터를 가진 단말은 다른 단말이 전송로를 사용하고 있는지를 확인함
    - 전송로에 접속된 모든 단말은 항상 전송로상의 모든 신호를 듣고 있어 전송로가 비어있는지 알 수 있다
  - 누구라도 송신할 수 있다 - MA(Multiple Access)
    - 데이터를 송신하고 싶은 단말은 CS에서 다른 단말이 통신하지 않는 것이 확인되면 언제든 송신할 수 있다
    - 특정 단말만이 아닌 모든 단말에 데이터를 송신할 권리가 있다
  - 충돌을 검출한다 - CD(Collision Detection)
    - 동시에 여러 대의 단말이 액세스를 시작했을 경우 충돌이 발생함
    - 충돌이 발생하면 데이터가 손실되므로 송신 측 단말은 충돌이 검출되면 데이터를 다시 보내야함

### 콜리전 도메인

- CSMA/CD 방식에 있어서 데이터 손실이 발생하는 범위를 콜리전 도메인이라고 함
- 콜리전 도메인 안에서는 한 번에 일대일로밖에 통신할 수 없음
- CSMA/CD 방식은 전송로를 쟁탈하는 방식으로 상대가 적으면 적을수록 송신하기 쉬워짐
  - 따라서 옛날에는 LAN상에 많은 단말이 없었기 때문에 CSMA/CD 방식도 제대로 기능함
- 2000년대 이후 네트워크 환경이 크게 변화하여 CSMA/CD에 대한 액세스 제어로는 데이터 충돌이 자주 일어나 더는 사용할 수 없게됨
- 문제는 하나의 콜리전 도메인 안에 여러 대의 단말이 존재한다는 것
- 콜리전 도메인을 작게 나누어서 각각에 포함된 단말을 줄이면 되는것인데 리피터 허브 기능에서는 구현이 불가능

### 콜리전 도메인을 분할할 수 있는 브릿지

- 콜리전 도메인을 분할하는 열쇠는 브릿지가 가진 피렅링 기능
  - 필터링은 프레임 내의 MAC 주소(2계층의 주소 정보)를 평가하여 그 프레임을 브릿지를 넘어 중계할 것인지를 판단하는 기능
  - 네트워크 간의 불필요한 데이터 송신을 억제하고 콜리전 발생을 방지함

#### 필터링 기능의 구조

- 브릿지는 장치 내부에 데이터베이스와 같은 MAC 주소 테이블이라는 것을 가지고 이를 참조하여 필터링 처리를 실시함
- MAC 주소 테이블에는 수신된 프레임안에 송신 측의 MAC 주소와 수신 포트를 연결한 정보를 자동으로 학습하거나 관리자가 수동으로 MAC 주소와 포트를 등록할 수 있음
- 수신 프레임에 대한 필터링 기능의 역할
  - 네트워크를 넘어가지 못하도록 함
    - 브릿지는 프레임을 수신하면 MAC 주소 테이블을 참조함
    - 수신한 프레임 중 목적지 MAC 주소가 그 프레임을 수신한 포트 자체에 연결되어 등록됐을 경우 네트워크를 넘어가지 못하도록 프레임을 파기함
  - 트래픽을 정리하고 LAN의 중계 역할을 함
    - 목적지 MAC 주소가 수신 포트 이외의 특정 포트에 연결되어 등록됐을 경우 프레임을 해당 특정 포트에서만 송출

### 정리

- 네트워크 환경의 변화에 따라 CSMA/CD 방식에 의한 데이터의 충돌 문제가 커져 리피터 허브는 사용되지 않음
- 콜리전 도메인을 분할하는 네트워크 기기로는 스위치와 브릿지가 있음

---------------------

## 먼저 스위치의 기본을 이해하자

### 리피터 허브와의 차이

#### 리피터 허브는 장비 자체가 콜리전 도메인

- 리피터 허브는 가지고 있는 모든 포트에게 데이터를 보냄
- 수신한 데이터 신호를 그냥 전달할 뿐이며 이 허브에 연결된 콜리전 도메인 내에서는 한 번에 일대일 통신밖에 할 수 없음

#### 브릿지나 스위치는 각 포트가 콜리전 도메인

- 스위치는 브릿지와 같이 장치 내부에 MAC 주소 테이블을 가지고 필터링 처리도 가능함
- 각 포트가 콜리전 도메인임

### 브릿지에서 스위치로

- 브릿지에서 스위치로 바뀐 이유는 장치의 큰 성능 차이 때문
- 브릿지는 프레임 분석과 전송 처리를 소프트웨어에서 하지만 스위치는 하드웨어에서 처리함
- 스위치는 브릿지와 비교해 처리 속도가 빠름

### 이것만은 기억하자! 스위치의 포인트

#### 스위치는 OSI 기본 참조 모델의 제2계층에 대응되는 중계기

- 스위치는 데이터 링크 계층에 대응되는 중계기
  - 레이어2 스위치라고도 함
- 단말이 송신한 프레임(데이터)을 받으면 그 프레임에 쓰여 있는 목적지(MAC 주소)를 조사하여 그 목적지가 접속되어 있는 포트에만
프레임을 전송함
  - 불필요한 트래픽이 흐르지 못하도록 하여 통신 효율 향상

#### 초기의 스위치는 장치 자체가 브로드캐스트 도메인

- L2 스위치는 MAC 주소 테이블을 참조하여 프레임의 목적지 포트를 결정하지만 목적지 MAC 주소가 브로드캐스트 주소(모든 단말을 나타내는 주소, FFFF:FFFF:FFFF)
이면 모든 포트로 전송함
  - L2 스위치에서는 스위치 전체가 하나의 브로드캐스트 도메인(브로드캐스트가 도달하는 범위)

#### MAC 주소의 학습 프로세스

- 스위치는 접속하고 있는 단말의 MAC 주소를 자동으로 학습하고 MAC 주소 테이블에 등록함
- 데이터가 들어오면 프레임의 출발지 MAC 주소가 테이블에 등록되어 있는지 확인하고 등록되지 않았다면 테이블에 등록함
- 목적지 MAC 주소가 테이블에 등록되어 있는지 확인하고 등록되어 있지 않다면 출발지 포트 이외의 모든 포트에 프레임을 보냄. 등록돼 있다면 해당 포트에만
프레임을 보냄

### 정리

- 리피터 허브는 장치 전체가 콜리전 도메인이지만 브릿지나 스위치는 각 포트가 콜리전 도메인
- 브릿지는 프레임의 분석과 전송 처리를 소프트웨어에서 하지만 스위치는 하드웨어에서 처리하기 때문에 고속의 데이터 분석과 전송 처리가 가능하여
대부분 스위치를 사용함
- 스위치는 OSI 기본 참조 모델의 제2계층에 대응되는 중계기고 이것을 L2 스위치라고 부름

-----------

## 조직 개편-당신이라면 어떻게 처리할까?(VLAN)

- 스위치의 기능 중 하나인 VLAN을 사용한다면 물리적으로 같은 구역에 있다고 해도 논리적으로는 다른 네트워크를 만들 수 있다.

### VLAN과 브로드캐스트 도메인

- VLAN이란 하나의 물리적인 네트워크를 복수의 논리적인 네트워크로 분할하는 기술이다.
  - VLAN을 사용하면 브로드캐스트 도메인을 분할 가능하다는 의미
  - 브로드캐스트 도메인이란 브로드캐스트 프레임(목적지 MAC 주소가 모든 단말을 나타내는 FFFF:FFFF:FFFF 프레임)이 도달하는 범위로
  라우터를 넘지 않고 직접 통신할 수 있는 범위
- L2 스위치에서는 원래 모든 포트가 하나의 브로드캐스트 도메인에 속하지만 VLAN 기능을 사용하면 포트마다 소속된 브로드캐스트 도메인을 임의로 설정하고 논리적인
그룹으로 나눌 수 있음
- VLAN의 이점
  - 네트워크의 구성을 간단히 변경할 수 있음
  - 조직에 맞춰 네트워크를 분할함으로써 보안을 강화할 수 있음
  - 브로드캐스트에 의한 네트워크 대역폭 소비를 줄일 수 있음

### 트렁크 링크로 하나의 케이블에 여러 VLAN 프레임을 사용

#### 만약 트렁크 링크가 없었다면?

- 단순히 생각하면 하나의 VLAN에 한 개의 케이블을 연결함
- 이 구성은 VLAN이 늘어날 때마다 케이블을 늘려야하기에 경제적인 방법이 아님

#### 트렁크 링크의 구조

- 트렁크 링크란 여러 VLAN의 트래픽을 전송하기 위한 스위치 간 접속 전용 링크
- 트렁크 링크에서는 링크 하나에 여러 VLAN의 프레임을 통과시키기 위해 각 프레임이 어느 VLAN에서 보내졌는지를 구별해야 하는데 이는
프레임에 속해 있는 VLAN을 식별하기 위한 정보를 확인하는데 이것이 태그

### VLAN 간의 통신

- 같은 VLAN에 속한 단말들은 각각 트렁크 링크를 통해 통신할 수 있지만 다른 VLAN 간의 단말은 통신이 불가능
  - VLAN으로 브로드캐스트 도메인이 분할되어 있기 때문
- VLAN이 다른 호스트끼리 통신이 가능해지기 위해서는 라우팅 기능을 가진 장치가 필요
  - 라우터나 L3 스위치

### 정리

- VLAN이란 하나의 물리적인 네트워크를 복수의 논리적 네트워크로 분할하는 기술
- VLAN의 이점
  - 네트워크 구성을 간단히 변경할 수 있음
  - 조직에 맞춰 네트워크를 분할하여 보안을 강화할 수 있음
  - 브로드캐스트로 인한 네트워크 대역폭의 소비를 절약할 수 있음
- VLAN의 종류
  - 스위치 포트와 VLAN을 대응시킨 포트 VLAN(정적 VLAN)
  - 스위치의 포트에 접속한 호스트 정보를 보고 소속된 VLAN을 동적으로 변경하는 동적 VLAN
- 트렁크 링크를 사용해 이더넷 프레임에 태그를 붙여 하나의 케이블에 여러 VLAN 프레임을 묶어 통신할 수 있음
- 소속 VLAN이 다른 호스트 간 통신을 위해 라우터나 L3 스위치로 라우팅 해야함

---------------

## 여러 가지 스위치 종류

- OSI 기본 참조 모델 일곱 계층 중에 어느 계층을 다루느냐에 따라 L2, L3, L4~7 스위치가 있음

### IP의 개념이 들어 있는 L3 스위치

- 서버와 통신하기 위해서는 VLAN 간 통신이 있어야함
  - 라우팅 기능을 가진 L3 필요
- VLAN 간 통신은 L3 스위치의 가장 큰 역할

#### L3 스위치의 구조

- L2 스위치에 라우터 기능이 더해진 스위치
- VLAN에 IP 주소를 할당하고 라우팅할 수 있음

#### L3 스위치의 특징

- VLAN 간의 통신이 가능
  - VLAN 기능을 사용한 브로드캐스트 도메인을 분할하면서 IP 기능을 이용한 라우팅을 수행하는 역할 담당
  - 스위치 포트 번호 1~10까지는 IP 주소 172.16.10.10을 보유한 VLAN10에 소속시킨다 라는 것이 가능
  - 기존 라우터에서는 하나의 물리 인터페이스(포트)에 대해 하나의 IP 주소를 가짐
- IP 패킷 전송을 하드웨어로 함

### 네트워크 부하를 분산하는 로드 밸런서(L4~7 스위치)

- 최신 웹 서버에서 응답 속도가 느려졌다 이 경우 문제의 원인은 다음 두 가지
  - 네트워크 인프라 전체에 발생한 문제?
  - 웹 서버 자체의 문제?

#### 네트워크 인프라 전체에 발생한 문제인가?

- L3 이하의 문제를 말함
- 네트워크 이용자 자체의 증가나 헤비 사용자가 데이터를 대량으로 전송하는 바람에 발생한 IP 네트워크망의 폭주를 의심
- 현재의 네트워크 환경에서는 점점 해소되어 가고 있음

#### 웹 서버 자체의 문제인가?

- L4 이상의 보완이 필요
- 웹 서버 자체를 높은 사양의 시스템으로 교체
- 로드 밸런서(부하분산)기술을 도입

#### 로드 밸런서 기능

- 부하분산 기능
  - 서버에 대한 부하분산
  - 로드 밸런서는 여러 대의 서버를 대표하는 가상적인 서버가 되어 사용자로부터의 액세스에 대한 적절한 서버로 요청을 분배
- 상태 확인 기능
  - 서버의 동작 상태를 확인하고 대상 서버가 정지되는 장애가 발생하면 그 서버에는 액세스하지 못하도록 전송을 중지하여 장애 영향을 경감하는 기능
- 세션 유지 기능
  - 첫 접속을 한 서버로 계속 접속해야 세션이 유지됨
  - 다음의 정보를 이용해 이후의 접속을 같은 서버로 할당
    - 발신 IP 주소
    - 쿠키 정보
    - URL 내에 들어 있는 세션 ID
    - HTTP 헤더

### 정리

- 스위치는 OSI 기본 참조 모델 7계층의 어느 레벨을 취급하느냐에 따라 L2, L3, L4~7 스위치 종류가 있음
- L3 스위치는 L2 스위치 + 라우터
- L3 스위치의 특징
  - VLAN 간 통신 가능
  - IP 패킷 전송을 하드웨어로 처리

---------------------

## 이중화로 네트워크의 신뢰성을 높인다

- 중/대규모 거점의 신뢰성을 높이기 위해 네트워크 이중화를 실시함
  - 장애 발생 시에 준비된 예비 회선이나 장치 본체를 사용한 구성

### 스위치 본체의 이중화

- 보통 운용에서 사용하는 스위치 이외에 예비 스위치를 준비해 두는 운용 방법

#### 스위치 본체에 장애가 발생했을 때

- 사용자는 백업 경로를 통해 우회하여 통신
- 운용에 지장을 주지 않고 지속적으로 통신
- 신뢰성을 중요시할 경우에 이상적인 구성이나 도입 기기도 늘어나게 되므로 운용도 복잡함

#### 스위치 포트나 LAN 배선에 장애가 발생했을 때

- 예비 통신 경로로 자동 전환

#### 이중화를 실현하는 기술

- 스패닝 트리 프로토콜(Spanning Tree Protocol, STP)
- 이중 경로에 의해 루프를 발견하여 루프 상태가 되지 않도록 특정 포트를 막아 트리 상태의 네트워크를 만듬
- 스위치 간 통신은 BPDU(Bridge Protocol Data Unit)라고 불리는 제어 정보를 주고받아 네트워크가 정상적으로 동작하는지 감시

### 스위치 단일 구성

- 비용은 저렴하나 신뢰성은 떨어짐

### 스패닝 트리 프로토콜을 사용하지 않는 이중화 방법이 메인

- 최근에는 대규모 네트워크에 있어서 스패닝 트리 프로토콜의 문제점이 표면화되어 사용하지 않음
  - 대역의 반이 낭비됨
    - 스패닝 트리 프로토콜에서 막힌 포트는 데이터를 전송할 수 없어 정상일 떄의 대역이 낭비됨
  - 설계나 운용이 복잡하고 손이 많이 감
    - 장애 발생 시 경로 전환이 자동적으로 이루어지지만 관리자가 그 부분을 예측하여 사전에 네트워크 전체를 고려한 설계를 해야 함
- 문제를 해결하기 위해 등장한 것이 스택 접속 + 링크 어그리게이션
  - 스택 접속이란 여러 대의 스위치를 논리적으로 한 대의 장치로서 인식하는 기능
  - 링크 어그리게이션은 여러 회선을 묶어 하나의 링크(대역)로 만드는 방법

### 정리

- 중/대규모 거점의 LAN에서는 네트워크 신뢰성을 높이는 일이 중요한 과제. 이중화하여 장애에 대비할 수 있음
- 최근 기업 네트워크에서는 스택 접속 + 링크 어그리게이션의 이중화 기술이 주로 사용됨