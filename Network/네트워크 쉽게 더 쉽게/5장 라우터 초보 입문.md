# 라우터 초보 입문

-----------

## 네트워크 전체에서의 라우터 위치

- 물리적인 관점에서 보면 라우터는 각 거점 네트워크(LAN)를 연결하는 역할을 함
  - WAN과 LAN의 경계선에 위치하는 네트워크 기기

### 소규모 거점에서의 라우터는 가장 중요한 기기

- 소규모 거점에 있어서 라우터는 거점 내의 네트워크 기기 중에서 가장 중요한 기기
  - 중/대규모 거점과 데이터를 주고받는 것이 대부분인데 WAN과 LAN의 경계선에 위치하는 라우터는 네트워크에 있어서 생명선
- 일반적으로 소규모 거점에서는 비용을 생각하여 라우터 이중화를 하지 않음

#### 소규모 거점에서의 라우터는 '멀티 플레이어'

- 라우터는 소규모 거점에서 여러 가지 역할 담당
  - 중규모나 대규모 거점에서 전용 네트워크 기기로 취급하는 방화벽이나 VPN 기능

### 중/대규모 거점에서의 라우터는 네트워크 간의 다리 역할에 치중

- 다른 거점으로의 다리 역할을 하는 외부 전용으로 특화되어 있음
- 내부적으로 다른 네트워크 간 연결은 L3 스위치가 맡아서 해줌

#### 담당하는 역할은 줄었지만 중요성은 증가

- 소규모 거점의 라우터에 비해 중/대규모 거점의 라우터는 역할이 적지만 역할의 중요성은 증가함
- 네트워크를 이용사는 사용자도 많아지고 장애가 발생했을 때 영향이 크기 때문
- 신뢰성이 있으며 보다 전문적이어야 함

### 정리

- 라우터는 각 거점 LAN을 연결하는 WAN과 LAN의 경계선에 위치하는 네트워크 기기
- 소규모 거점에 있어서 라우터는 데이터 전달부터 보안 기능까지 여러 역할을 한 대로 처리
- 중/대규모 거점에 있어서의 라우터는 외부와의 데이터 전송에 특화됨
  - 네트워크를 정지하지 않고 빠른 패킷을 전송하는 것이 역할

-----------------------

## 라우터의 역할과 기본 원리

### 라우터는 네트워크 계층에 해당하는 기기

- OSI 기본 참조 모델에서 보면 3계층(네트워크 계층)에 해당
- 브릿지나 스위치가 2계층(데이터 링크 계층)에 속해 있어 물리 주소인 MAC 주소를 기반으로 처리하는 것에 비해
라우터는 네트워크 계층의 논리 주소인 IP 주소를 기반으로 라우팅을 처리함

### 라우팅

- 라우터는 단순히 다른 네트워크를 연결하는 역할만 하는 것은 아니며 적절한 네트워크로 분배하는 역할도 하게 되는데 이것을 라우팅이라고 함
- 라우터는 자신이 가지고 있는 라우팅 테이블 상의 정보를 가지고 패킷을 라우팅함
  - 라우팅을 위한 일종의 데이터베이스
- 라우팅 테이블 안에는 목적지 경로를 나누기 위한 정보를 가지고 있음
  - 목적지의 네트워크 주소
  - 목적지의 네트워크로 패킷을 보내기 위한 자신의 인터페이스
  - 목적지의 네트워크에 패킷을 보낼 때의 다음 라우터 주소
  - 목적지의 최적 경로를 선택하기 위한 값
- 라우터는 전송 받은 패킷의 헤더에 포함되어 있는 목적지 네트워크 주소와 라우터 자신의 라우팅 테이블 내의 정보와 비교하여
목적지 네트워크에 패킷을 확실히 전달하기 위해 자신이 가지고 있는 어떤 인터페이스에 패킷을 보내면 좋을까를 판단함
- 라우터는 만일 자신의 라우팅 테이블 내의 일치하는 라우팅 정보가 없을 경우 패킷을 파기함
  - 어떤 인터페이스로 보내야 할지 판단할 수 없기 때문
- 네트워크에 바로 도입된 라우터는 라우팅 정보가 없기 때문에 학습시켜야 함
  - 수동 학습 방법
    - 정적(스태틱) 라우팅 방식
  - 자동 학습 방법
    - 동적(다이내믹) 라우팅 방식

#### 네트워크 관리자가 설정하는 정적 라우팅 방식

- 관리자가 콘솔 단말을 통하여 라우터의 라우팅 테이블에 라우팅 정보를 하나 하나 등록하는 방식
- 관리자가 생각하는 대로 패킷의 경로를 결정할 수 있으며 라우터나 네트워크 전체에 부하를 주지 않음
- 한 대의 라우터를 추가하기 위해 다른 라우터에서도 변경 작업을 해야 하기 때문에 운용 후의 유지보수는 손이 많이 감
- 소규모 네트워크에 사용하면 적당함

#### 라우터가 자동으로 학습하는 동적 라우팅 방식

- 라우팅 정보를 다른 라우터에서 자동으로 받아오는 방법
  - 라우팅 프로토콜이라는 라우터 간에 라우팅 정보를 교환하기 위한 전용 프로토콜 사용
- 정적 라우팅과 달리 라우터나 네트워크 자체에 부하가 발생함
  - 라우터끼리 정기적으로 라우팅 정보를 교환하기 때문에 그만큼 네트워크에 데이터를 보내게 되며 라우터가 그 정보를 모두 처리해야 하기 때문

### 라우팅 프로토콜

#### 라우팅 정보를 학습하는 순서

- 동적 라우팅이 라우팅 정보를 학습하는 알고리즘에는 크게 세 가지
  - 디스턴스 벡터 알고리즘
  - 링크 스테이트 알고리즘
  - 패스 벡터 알고리즘

#### 인접한 라우터끼리 라우팅 정보를 학습하는 디스턴스 벡터 알고리즘

- 자기 자신의 라우팅 테이블 상태를 인접해 있는 라우터에 일방적으로 보내는 방식
- 대표적인 프로토콜 RIP(Routing Information Protocol)
- RIP의 용어에서는 라우터 한 대를 지나는 것을 한 홉(Hop)라고 함
- RIP 에서는 이 홉 수가 적은 경로를 제일 짧은 경로로 판단하여 패킷을 중계하는 매우 단순한 방법
  - 거리는 상관없음
- 단점은 패킷을 최대 15홉 라우터까지밖에 전송하지 못하기 때문에 대규모 네트워크에서는 적합하지 않은 프로토콜

#### RIP에 있어서 라우팅 테이블의 학습

- 자기 자신의 정보를 보낼 때 다른 테이블에서 온 거리를 +1 해서 보냄
- 최종적으로 자기 자신과 얼마나 떨어져있는지 알 수 있음

#### 링크 스테이트 알고리즘

- 라우터 자체가 접속해 있는 네트워크에 대한 정보(이것을 링크 상태라고 함)를 특정 범위 내에 있는 모든 라우터에 통지
- 다른 라우터의 링크 상태를 수신한 라우터는 그 정보를 기반으로 경로의 정보를 학습하고 라우팅 테이블을 생성함
- 대표적인 프로토콜 OSPF(Open Shortest Path First)
- OSPF가 RIP와 크게 다른 점은 네트워크를 계층 구조화하여 서브넷 마스크에 사용할 수 있다는 것
  - 대규모 네트워크에서만 사용할 수 있음

#### OSPF의 라우팅 방법

- 각 라우터는 네트워크에 대한 정보를 주고받은 결과 링크 정보 데이터베이스를 작성함
- 링크 정보 데이터베이스를 가지고 각 링크(경로)에 할당된 비용에서 최적 경로를 계산함
  - 최적 경로란 그 링크(경로) 비용이 최솟값이 되는 경로
    - 회선의 속도나 지연 시간으로 계산함

### 일치하는 라우팅 정보가 없을 때 할당되는 경로

- 라우터는 라우팅 테이블 내에 일치하는 라우팅 정보가 없을 때는 패킷을 파기하지만 파기하지 않고 미리 설정해 둔 경로로
패킷을 보낼 수 잇는데 이것이 기본 경로다.
  - PC에 설정된 기본 게이트웨이와 동일
- 기본 게이트웨이는 자신이 소속되어 있는 네트워크 이외의 다른 곳으로 데이터를 보낼 때는 반드시 여기로 보내라라는 목적지 설정
  - 네트워크 경계에 존재하는 라우터 IP 주소를 기본 게이트웨이로 설정함

### 다른 LAN 간의 접속

- 라우터에 의해 분할된 네트워크에는 각각 다른 네트워크 주소가 할당됨

### 정리

- 라우터는 3계층(네트워크 계층)에 해당하는 기기
- 라우터는 라우팅 테이블상의 정보를 기반으로 패킷을 라우팅함
  - 목적지 네트워크 주소
  - 목적지 네트워크로 패킷을 보낼 자신의 인터페이스
  - 목적지 네트워크에 패킷을 보낼 때의 다음 라우터 주소
  - 목적지까지의 최적 경로를 선택하기 위한 값
- 라우팅 테이블에 라우팅 정보를 학습시키기 위해서는 두 가지 방법
  - 정적 라우팅
  - 동적 라우팅
- 정적 라우팅은 관리자가 라우팅 테이블에 라우팅 정보를 하나하나 등록하는 방법
- 동적 라우팅은 다른 라우터에게 라우팅 정보를 받는 방법(라우팅 프로토콜 사용)
- 라우팅 프로토콜
  - 디스턴스 벡터 알고리즘
  - 링크 스테이트 알고리즘
  - 패스 벡터 알고리즘
- RIP은 디스턴스 벡터 알고리즘의 라우팅 프로토콜
- OSPF는 링크 스테이트 알고리즘의 라우팅 프로토콜
- 기본 경로를 설정해두면 라우팅 테이블 내에 일치하는 라우팅 정보가 없을 때도 패킷을 파기하지 않고 기본 경로로 보냄

----------------

## 라우터에도 종류가 있다

- 라우터가 적용된 분야 다섯 가지
  - 서비스 프로바이더용 네트워크
  - WAN 네트워크
  - 대규모 거점 네트워크
  - 중/소규모 거점 네트워크
  - 서버 팜

### 서비스 프로바이더용 네트워크에는 성능이 가장 좋은 라우터를 선택

- 서비스 프로바이더용 네트워크의 대표적인 통신 서비스로는 광역 이더넷과 IP-VPN
  - KT, SKT, LG..
- 코어 라우터와 엣지 라우터 사용
  - 광역 이더넷망이나 IP-VPN망 안에 존재
- 코어 라우터의 가장 큰 역할은 엣지 라우터에서 온 데이터를 통신 사업자망(서비스 프로바이더용 네트워크)안에서 중계하는 것
- 엣지 라우터의 역할은 통신 사업자망 안과 고객의 구내 네트워크를 연결하는 것
- 두 라우터 모두 대용량 데이터를 다루며 고속 처리가 요구됨
  - 제일 사양이 높고 크기도 크고 가격도 비쌈

### WAN 네트워크에서 사용되는 라우터

- 고객 쪽에서 사용하는 WAN 랑우터는 고객의 거점 간을 연결하기 위한 역할을 담당
- 액세스 라우터
  - 통신 사업자 사람들은 액세스 라우터를 커스터머 엣지 라우터라고 함
  - 통신 사업자 측에서 보면 고객의 건물 내의 엣지 부분에 설치되어 있는 라우터가 고객과의 책임 경계점이기 때문
- 액세스 라우터는 거점의 크기에 따라 사양이 달라짐

### 구내에서의 라우터는 L3 스위치

- 모든 L3 스위치가 제 역할을 다함

### 그 외의 라우터 종류

#### 여러 프로토콜을 사용할 수 있는 멀티 프로토콜 라우터

- TCP/IP 이외의 IPX/SPX나 AppleTalk과 같은 프로토콜을 지원하는 것처럼
여러 프로토콜을 사용하는 라우터를 멀티 프로토콜 라우터라고 함
- 고가이며 기업용 라우터에 속함

#### 액세스 라우터(소규모 거점 네트워크용)

- 광 회선을 액세스 회선으로 쓰는 인터넷 연결에 이용

### 정리

- 라우터는 사용되는 환경이나 네트워크 환경에 따라 몇 가지 종류가 있음
- 서비스 프로바이더용 네트워크에서 사용되는 라우터가 코어 라우터와 엣지 라우터
- WAN 네트워크에서 사용되는 라우터를 통신 사업자 쪽에서는 커스터머 엣지 라우터, 고객 쪽에서는 액세스 라우터라고 함
- 구내 네트워크(대규모 거점 네트워크, 중/소규모 거점 네트워크, 서버 팜)에는 L3 스위치가 라우팅을 함

-------------

## L3 스위치와의 차이점

### 패킷 전송을 하드웨어로 처리하는 L3 스위치

- 라우터와 L3의 가장 큰 차이점은 패킷 전송을 소프트웨어적으로 하는가, 하드웨어적으로 하는가가 있다.
  - 라우터가 전자, L3는 후자
- 라우터의 경우 CPU와 메모리가 연계하여 소프트웨어에 패킷을 전송함
- L3 스위치의 경우 ASIC라고 불리는 전용 칩으로 패킷의 전송을 처리
  - 라우터보다 더 빠르게 패킷을 처리할 수 있음
- 하드웨어 처리를 하는 라우터도 늘어남

### 라우터는 VPN이나 NAT/NAPT 기능을 지원

- 라우터의 장점은 WAN이나 인터넷 연결에 특화된 기능을 가지고 있다는 것
- 라우터와 L3 스위치는 다른 것이나 비슷한 부분이 있음
- 라우터에는 있으나 L3 스위치에는 없는 기능은 VPN 기능과 NAT/NATP 기능(주소 변환)

#### VPN 기능을 사용하여 안전한 네트워크를 실현

- 인터넷망 내부에는 아무런 보안 대책도 준비되어 있지 않기 때문에 단말 쪽인 접속하는 사용자나 기업이 스스로 책임지고 대책을 강구해야 함
- 인터넷망 내부에 VPN 기능을 사용하여 대규모 거점이나 중규모 거점에 연결되어 있음
- 실제 사용자 간의 통신에 쓰이는 패킷을 암호화하거나 인증하는 방법을 사용함
- 인터넷 VPN은 인터넷망을 사이에 두고 가상 암호와 터널로 라우터끼리 연결하고 있다 생각하면 됨

#### 일대다 주소 변환을 실현하는 NAT/NAPT 기능

- 소규모 거점이나 일반 가정에서도 여러 단말을 사용하는 경우 하나의 공인 주소와 여러 사설 주소의 식별은
포트 번호를 이용해 이루어짐

#### 인터넷 접속 서비스에 곧잘 이용되는 PPPoE

- PPPoE(PPP over Ethernet)는 가정 내 LAN에 접속된 PC나 라우터 등의 기기와 ISP 내에 설치된 통신 기기 사이에
접속을 확립하는 수단으로서 이요되는 기술

### 정리

- 라우터는 패킷을 소프트웨어로 전송하고 L3 스위치는 패킷을 하드웨어로 전송
  - 하드웨어 처리가 더 빠름
  - 현재는 하드웨어 처리를 하는 라우터도 늘어남
- 라우터의 장점은 WAN이나 인터넷 연결에 특화시킨 기능을 갖추고 있는 것
  - VPN
  - NAT/NAPT(주소 변환)
  - PPPoE

--------------

## 라우터를 효과적으로 사용하기 위해서는

### 패킷 필터링

- 라우터의 간단한 보안 기능
- 네트워크 계층(L3)의 데이터 단위인 패킷의 헤더에 들어 있는 정보를 기반으로 필터링 처리를 실행할 수 있음
  - 패킷을 통과시키느냐/통과시킬 수 없느냐 판단
  - 172.16.1.0 네트워크로의 패킷은 패기 OR FTP 트래픽만 허가 라는 프로토콜 단위의 처리가 이루어지기도 함
- 고가의 라우터일수록 상세한 설정이 가능

### 이중화로 네트워크의 신뢰성을 높인다

- 중/대규모 거점 네트워크에서는 네트워크의 신뢰성이 가장 중요한 과제
- 라우터의 이중화를 함

#### 이중화에도 종류가 있다

- WAN 쪽이 이중화되어 있다는 것은 WAN으로 나가는 출구도 여러 개 존재한다는 것
  - 여러 대의 라우터가 각각의 WAN 회선을 보유
    - 액티브와 스탠바이 두 대로 운용하며 회선도 각자 따로 가짐
  - 한 대의 라우터로 여러 WAN 회선을 보유
    - 신뢰성은 약간 떨어지나 비용 측면에서 이점이 있음
    - 라우터 자체에 장애가 발생한다면 모든 통신이 불가능해짐
- 오늘날 네트워크의 의존성을 생각한다면 신뢰성이 높은 네트워크 구성인 여러 대의 라우터가 각각의 WAN 회선을 보유가 이상적인 구성

### 정리

- 라우터는 간단한 보안 기능으로 패킷 필터링 기능을 가짐
- 중/대규모 거점의 네트워크에서는 네트워크 신뢰성을 높이기 위해 라우터를 이중화함
- 이중화 방법 두 가지
  - 여러 대의 라우터가 각각의 WAN 회선을 보유
  - 한 대의 라우터로 여러 WAN 회선을 보유
