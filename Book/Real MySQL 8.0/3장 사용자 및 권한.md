# 사용자 및 권한

- MySQL의 사용자 계정은 단순히 사용자의 아이디뿐 아니라 해당 사용자가 어느 IP에서 접속하고 있는지도 확인한다.
- MySQL 8.0 버전부터는 권한을 묶어서 관리하는 역할(Role, 롤)의 개념이 도입됐기 때문에 각 사용자의 권한으로 미리 준비된 권한 세트를 부여하는 것도
가능하다.

-----------

## 사용자 식별

- MySQL의 사용자는 다른 DBMS와는 조금 다르게 사용자의 계정뿐 아니라 사용자의 접속 지점도 계정의 일부가 된다.
- MySQL에서 계정을 언급할 때는 항상 아이디와 호스트를 함께 명시해야 한다.
```shell
'svc_id'@'127.0.0.1'
```

- 모든 외부 컴퓨터에서 접속이 가능ㅎ나 사용자 계정을 생성하고 싶다면 사용자 계정의 호스트 부분을 %문자로 대체하면 된다.
```shell
'svc_id'@'192.168.0.10' (비밀번호는 123)
'svc_id'@'%' (비밀번호는 abc)
```

- 권한이나 계정 정보에 대해 MySQL은 범위가 가장 작은 것을 항상 먼저 선택한다.
- 사용자 IP가 192.168.0.10에서 svc_id/abc로 로그인하면 비밀번호가 일치하지 않는다라는 이유로 접속이 거절된다.

---------

## 사용자 계정 관리

### 시스템 계정과 일반 계정

- MySQL 8.0부터 계정은 SYSTEM_USER 권한을 가지고 있느냐에 따라 시스템 계정과 일반 계정으로 구분된다.
- 시스템 계정은 데이터베이스 서버 관리자를 위한 계정이며, 일반 계정은 응용 프로그램이나 개발자를 위한 계정이다.
- 데이터베이스 서버 관리와 관련된 중요 작업은 시스템 계정으로만 수행할 수 있다.
  - 계정 관리(계정 생성 및 삭제, 계정의 권한 부여 및 제거)
  - 다른 세션(Connection) 또는 그 세션에서 실행 중인 쿼리를 강제 종료
  - 스토어드 프로그램 생성 시 DEFINER를 타 사용자로 설정
- MySQL 서버에는 다음과 같은 내장된 계정들이 있는데, 'root'@'localhost'를 제외한 3개의 계정은 내부적으로 각기 다른 목적으로 사용되므로 삭제하면 안된다.
  - 'mysql.sys'@'localhost'
    - MySQL 8.0부터 기본으로 내장된 sys 스키마의 객체들의 DEFINER로 사용되는 계정
  - 'mysql.session'@'localhost'
    - MySQL 플러그인이 서버로 접근할 때 사용되는 계정
  - 'mysql.infoschema'@'localhost'
    - information_schema에 정의된 뷰의 DEFINER로 사용되는 계정

### 계정 생성

- MySQL 5.7 버전까지는 GRANT 명령으로 권한의 부여와 동시에 계정 생성이 가능했으나 8.0 버전부터는 계정의 생성은 CREATE USER 명령으로, 권한 부여는 GRANT
명령으로 구분해서 실행하도록 바뀌었다.
- 계정을 생성할 때는 다음과 같은 다양한 옵션을 설정할 수 있다.
  - 계정의 인증 방식과 비밀번호
  - 비밀번호 관련 옵션(비밀번호 유효 기간, 비밀번호 이력 개수, 비밀번호 재사용 불가 기간)
  - 기본 역할
  - SSL 옵션
  - 계정 잠금 여부

- 일반적으로 많이 사용되는 옵션을 가진 CREATE USER 명령은 다음과 같다.
```mysql
CREATE USER 'user'@'%'
IDENTIFIED WITH 'mysql_native_password' BY 'password'
REQUIRE NONE
PASSWORD EXPIRE INTERVAL 30 DAY
ACCOUNT UNLOCK 
PASSWORD HISTORY DEFAULT 
PASSWORD REUSE INTERVAL DEFAULT 
PASSWORD REQUIRE CURRENT DEFAULT;
```