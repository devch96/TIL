# InnoDB 클러스터

- 소스-레플리카 구조의 복제 형태로 구성해놓는다고 해서 고가용성이 실현되는 것은 아니다.
  - 소스 서버에서 장애가 발생했을 때 레플리카 서버가 자동으로 기존 소스 서버를 대체하는 새로운 소스 서버로
  전환되는 것은 아니기 때문
- MySQL 서버는 자체적으로 페일오버(Failover)를 처리하는 기능을 제공하지 않으므로 사용자는 장애가 발생했을 때 레플리카 서버가
새로운 소스 서버가 될 수 있도록 일련의 작업들을 수행해야 한다.
  - 레플리카 서버에 설정된 읽기 모드 해제
  - 스플릿 브레인 현상을 방지하기 위해 장애가 발생한 소스 서버에서 데이터 변경을 실행하지 못하도록 함
  - 애플리케이션 서버는 새로운 소스 서버를 바라보도록 커넥션 설정
- 대부분의 이와 같은 전환 작업을 계속 수동으로 처리하기 보다는 자동화하는 것을 고려함
  - 서버 장애를 감지해 자동으로 페일오버를 처리하는 프로그램을 직접 개발 혹은 외부 솔루션 사용
    - MMM, MHA, Orchestrator

----------

## InnoDB 클러스터 아키텍처

- InnoDB 클러스터는 단순하게 MySQL 서버 내에서 설정할 수 있는 어떤 특정한 기능이 아닌 MySQL의 고가용성 실현을 위해 만들어진 여러 구성 요소들의
집합체다.
- InnoDB 클러스터 구성 요소
  - 그룹 복제
    - 소스 서버의 데이터를 레플리카 서버로 동기화하는 기본적인 복제 역할뿐만 아니라 복제에 참여하는 MySQL 서버들에 대한 자동화된 멤버십 관리
      (그룹에 새로운 멤버 추가 및 제거 등) 역할을 담당한다.
  - MySQL 라우터
    - 애플리케이션 서버와 MySQL 서버 사이에서 동작하는 미들웨어 프로그램.
    - 애플리케이션이 실행한 쿼리를 적절한 MySQL 서버로 전달하는 프록시 역할
  - MySQL 쉘
    - 기존 MySQL 클라이언트보다 좀 더 확장된 기능을 가진 새로운 클라이언트 프로그램
    - SQL문 실행뿐만 아니라 자바스크립트 및 파이썬 기반의 스크립트 작성 기능과 MySQL 서버에 대해 클러스터 구성 등의 어드민 작업을 할 수 있게 하는
    API 제공
- InnoDB 클러스터에서는 MySQL 서버에 장애가 발생하면 그룹 복제가 먼저 이를 감지해서 자동으로 해당 서버를 복제 그룹에서 제외시키며,
MySQL 라우터는 이러한 복제 토폴로지 변경을 인지하고 자신이 가진 메타데이터를 갱신해서 클라이언트로부터 실행된 쿼리가 현재 복제 그룹에서 정상적으로 동작하는
MySQL 서버로만 전달될 수 있도록 한다.

---------------

## 그룹 복제

- 그룹 복제는 5.7.17 버전에서 도입된 새로운 복제 방식이며, 기존 MySQL 복제 프레임워크를 기반으로 구현되어 내부적으로 Row 포맷의 바이너리 로그와 릴레이 로그,
GTID를 사용한다.
- 기존 복제의 경우 일반적으로 소스-레플리카 형태로 구성되어 단방향으로만 복제가 이뤄지는 반면, 그룹 복제에서는 복제에 참여하는 MySQL 서버들이 하나의 복제 그룹으로
묶인 클러스터 형태를 가지며 그룹 내 서버들은 서로 통신하면서 양방향으로도 복제 처리를 할 수 있다.
- 