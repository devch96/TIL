# 브랜치

-----------

## 새로운 작업

- 브랜치(branch)는 나뭇가지, 지사, 분점 등 줄기 하나에서 뻗어 나온 갈림길을 의미
- 저장 공간 하나에 가상의 또 다른 저장 공간을 만드는 것과 같음

### 브랜치 작업

- 깃을 사용하면 프로젝트 작업 폴더를 복사하지 않고 기존 코드와 분리해서 작업할 수 있음

### 깃 브랜치 특징

- 가상 폴더
  - 외부적으로는 물리적인 파일 하나만 있음
  - 쉽게 가상 폴더인 브랜치를 이동할 수 있음
- 독립적인 동작
  - 원본 폴더와 분리하여 독립적으로 개발 작업을 수행할 수 있음
  - 분리된 코드를 좀 더 쉽게 병합할 수 있음
- 빠른 동작
  - 다른 VCS들은 브랜치를 생성할 때 내부 파일 전체를 복사하지만 깃은 Blob 개념을 도입하여 내부를 구조화함
    - 포인터와 유사한 객체
  - 브랜치 명령을 사용하면 내부적으로 커밋을 하나 생성하여 브랜치로 할당함

------------

## 브랜치 생성

- 브랜치는 가상의 작업 폴더
- 새 브랜치를 생성하면 포인터만 있는 브랜치가 생성됨

### 브랜치 생성

- git branch 브랜치이름 커밋ID
- 커밋ID를 작성하지 않으면 현재 HEAD 포인터를 기준으로 새로운 브랜치 생성

### 브랜치 이름

- 사전 예약된 명칭은 없지만 여러 브랜치 전략이 있음
- 기호로 시작할 수 없음
- 마침표로 시작할 수 없음
- 연속적인 마침표를 포함할 수 없음
- 빈칸,공백 문자, 물결, 캐럿(^), 물음표, 별표, 대괄호 등은 포함할 수 없음
- 아스키 제어 문자는 포함할 수 없음
- 이름이 중복될 수 없음

-----------------

## 브랜치 확인

### 간단 브랜치 목록

- git branch
- 별표(*)는 현재 선택된 브랜치

### 브랜치 해시

- 브랜치는 커밋의 해시 값을 가리킴
- 브랜치를 생성한 기준 커밋의 해시 값과 동일

### 브랜치 세부 사항 확인

- git branch -v (--verbose)
  - 브랜치 이름, 커밋 ID, 커밋 메시지

--------------

## 브랜치 이동

### 체크아웃

- 현재 브랜치를 떠나 새로운 브랜치로 들어간다는 의미
- git checkout 브랜치이름

### 브랜치 동작 원리

- checkout 명령어로 브랜치가 변경되면 깃은 내부적으로 동작을 수행함
  - HEAD 정보는 항상 변경된 브랜치의 마지막 커밋을 가리킴. 브랜치가 이동하면 HEAD 포인터도 함께 이동
  - 기존 브랜치의 워킹 디렉터리를 정리하지 않고서는 브랜치를 변경할 수 없음

### 이전 브랜치

- 리눅스에서 대시(-) 기호는 이전 디렉터리를 의미함
- git checkout -

### 워킹 디렉터리 정리

- 워킹 디렉터리에서 작업하다 커밋하지 않고 남겨 둔 상태에서 다른 브랜치로 체크아웃하면 브램치 이동이 제한됨
- 향후 충돌을 방지하기 위함
- 작업된 워킹 디렉터리를 커밋하지 않고 브랜치를 변경할 때는 스태시 기능을 이용하면 좋음

----------------

## 브랜치 공간

### 브랜치 로그

- 로그를 출력할 때 브랜치 흐름도 같이 보려면 --graph 옵션
  - git log --graph --all
  - --more 옵션으로 출력될 커밋 갯수를 제한할 수 있음

------------------

## HEAD 포인터

### 마지막 커밋

- 깃은 마지막 커밋 정보 기반으로 새로운 커밋을 생성하기에 마지막 커밋 정보가 중요
- 시스템이 매번 커밋할 때마다 마지막 커밋 정보를 찾으면 부하가 발생하기 때문에 특수한 포인터를 제공하는데 그것이 HEAD
- 깃은 마지막 커밋을 가리키는 HEAD 포인터를 부모 커밋으로 대체하여 사용

### 브랜치 HEAD

- 브랜치를 이동하면 HEAD 포인터도 이동됨
- 브랜치가 여러 개면 HEAD 포인트도 여러 개

### 상대적 위치

- HEAD 포인터를 기준으로 상대적 커밋 위치도 지정할 수 있음
- 상대적 커밋 위치를 지정할 때는 캐럿(^)과 물결(~)을 사용함
- ^과 ~는 HEAD를 기준으로 몇 번째인지 상대적인 위치를 지정함
- HEAD 바로 이전
  - HEAD^, HEAD~
- HEAD 기준으로 이전 3개
  - HEAD^^^, HEAD~~~
  - HEAD^3, HEAD~3
- 특정 위치는 해시키가 편리함

### AHEAD, BHEAD

- 로컬저장소 브랜치의 HEAD 포인터와 원격 저장소 브랜치의 HEAD 포인터
- AHEAD,BHEAD는 서로 다른 저장소 간 HEAD 포인터의 위치 차이를 의미
- 브랜치를 여러개 운영한다면 다수의 AHEAD와 BHEAD가 생길 수 있음

#### AHEAD

- 서버로 전송되지 않은 로컬 커밋이 있는 것

#### BHEAD

- 로컬 저장소로 내려받지 않은 커밋이 있는 것

---------------------

## 생성과 이동

### 자동 이동 옵션

- 체크아웃할 때 -b 옵션을 같이 사용하면 생성과 이동을 한 번에 함
    - git checkout -b 브랜치이름

### 커밋 이동

- 브랜치는 특정한 커밋에 별명을 부여한 것과 같으므로 커밋 해시키를 사용하여 체크아웃할 수 있음
  - git checkout 커밋해시키

### HEAD를 활용한 이동

- 커밋의 해시키를 사용하여 체크아웃하면 해시키를 알아야 하므로 상대적 위치 를 사용해도됨
  - git checkout HEAD~1

### 돌아오기

- 대시(직전)
  - git checkout -
- 여러 번 이동했으면 브랜치로 이동하는 것이 편리
  - git checkout main

---------------

## 원격 브랜치

### 리모트 브랜치

- 원격 저장소에 생성한 브랜치
- 로컬 저장소에 생성한 브랜치를 서버로 공유할 수 있음
- git push 원격저장소별칭 브랜치이름

### 이름이 다른 브랜치

- git push origin 브랜치이름:새로운브랜치

### 업스트림 트래킹

- 리모트 브랜치는 브랜치 이름을 동일하게 혹은 다른 이름으로 생성할 수 있음
- 로컬 저장소의 브랜치와 원격 저자소의 브랜치는 업로드할 수 있도록 매칭되어 있는데 이러한 매칭을 업스트림 트래킹이라고 함
- 트래킹 브랜치는 리모트 브랜치와 로컬 브랜치를 연결해주는 중간 다리 역할
- git checkout --track origin/브랜치이름

### 원격 브랜치 복사

- git checkout -b 새이름 origin/브랜치이름

### 업스트림 연결

- 기존에 있는 브랜치를 업스트림으로 직접 설정할 수 있음
- git branch -u origin/브랜치이름

----------------

## 브랜치 전송

- 로컬 저장소의 브랜치를 원격 저장소로 전송하는 다른 방법

### 브랜치 푸시

- 원격 저장소 연결만으로 업스트림이 자동으로 설정되지는 않음. 따라서 수동으로 트래킹 브랜치와 업스트림을 설정해야 함
  - git push -u origin main

### 브랜치 페치

- 일반적인 커밋 페치와 동일
- git merge 원격저장소별칭/브랜치이름

---------------

## 브랜치 삭제

- 자신이 있는 브랜치는 삭제 불가능

### 일반적인 삭제 방법

- git branch -d 브랜치이름
  - -d는 스테이지 상태가 clean 할 때만 삭제를 허용

### 강제로 삭제 하는 방법

- git branch -D 브랜치이름