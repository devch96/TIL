# 코드 품질

- 고품질 코드는 일반적으로 좀 더 신뢰할 수 있고, 유지보수가 쉬우며, 버그가 적은 소프트웨어를 생산함
- 코드 품질을 높이는 것에 관한 많은 원칙들은 소프트웨어가 처음에 만들어지는 방식을 보장하는 것뿐만 아니라 이후 요구 사항이 진화하고
새로운 상황이 등장하더라도 그 방식을 계속 유지할 수 있도록 하는 것에 관심을 둠

--------------

## 코드는 어떻게 소프트웨어가 되는가

- 코드는 엔지니어가 작성하자마자 실제로 실행되는 소프트웨어가 되는 것이 아님
  - 코드가 의도한 대로 작동하고 기존의 기능이 여전히 잘 작동한다고 확신하기 위한 다양한 과정과 점검이 이루어짐
    - 테스트
  - 이러한 과정을 개발 및 배포 프로세스라고 부름
- 코드베이스(codebase)
  - 소프트웨어를 빌드할 수 있는 코드가 저장된 저장소(repository)
  - 일반적으로 깃, 서브버전, 퍼포스 등과 같은 형상 관리 시스템(version control system)에 의해 관리됨
- 코드 제출(submitting code)
  - 코드 커밋 혹은 풀 요청 병합(merging a pull request)
  - 개발자는 일반적으로 코드베이스를 자신의 로컬 컴퓨터에 복사하고 여기서 코드를 변경
  - 코드 변경이 끝나면 변경된 사항을 메인 코드베이스에 제출함
- 코드 검토(code review)
  - 작성한 코드를 코드베이스에 제출하기 전에 다른 엔지니어가 변경된 내용을 검토하는 과정
  - 원고 교정과 비슷하며 코드 검토 중에 종종 코드 작성자가 놓친 문제를 발견함
- 제출 전 검사(pre-submit check)
  - 병합 전 훅, 병합 전 점검, 커밋 전 점검이라고 함
  - 테스트가 실패하거나 코드가 컴파일되지 않을 경우 변경 사항이 코드베이스에 병합되지 않도록 차단함
- 배포(release)
  - 코드베이스의 특정 버전을 가져와서 배포하는 프로세스를 일컬어 배포 브랜치 만들기(cutting release)라고 함
- 프로덕션(production)
  - 소프트웨어가 서버나 시스템에 배포될 때, 테스트 환경과 같이 내부적으로 사용하는 것이 아닌 실제 서비스 되는 환경을 가리킴

1. 개발자가 코드베이스의 로컬 복사본을 가지고 작업하면서 코드를 변경
2. 작업이 끝나면 코드 검토를 위해 변경된 코드를 가지고 병합 요청
3. 다른 개발자가 코드를 검토하고 변경을 제안할 수 있음
4. 작성자와 검토자가 모두 동의하면 코드가 코드베이스에 병합됨
5. 배포는 코드베이스를 가지고 주기적으로 일어남
6. 테스트에 실패하거나 코드가 컴파일되지 않으면 코드베이스에 병합되는 것을 막거나 배포되는 것을 막음

--------------

## 코드 품질의 목표

- 코드 품질은 실제적인 관심 사항에 근거를 둠
  - 작동해야 함
  - 작동이 멈춰서는 안 됨
  - 변화하는 요구 사항에 적응해야 함
  - 이미 존재하는 기능을 또다시 구현해서는 안 됨

-----------

### 코드는 작동해야 한다

- 코드를 작성하는 이유는 문제를 해결하기 위함
- 코드가 `작동한다`라는 것을 정의할 때, 모든 요구 사항을 파악할 필요가 있음
  - 해결하려는 문제가 성능 향상에 관한 것이라면(지연 시간 혹은 CPU 사용량 등) 코드가 그에 맞게 수행되도록 하는 것은
  요구 사항의 일부를 충족하는 것이기 때문에 목표에 부합함
  - 사용자 개인 정보 보호 및 보안과 같은 다른 고려 사항도 마찬가지

### 코드는 작동이 멈추면 안 된다

- 코드는 고립된 환경에서 홀로 실행되는 것이 아니기 때문에 주의하지 않으면 주변 상황이 바뀌면서 동작이 멈출 수 있음
  - 코드는 다른코드에 의존할 수 있는데, 그 코드가 수정되고 변경될 수 있음
  - 새로운 기능이 필요할 때 코드를 수정해야 할 수 있음
- 당장 돌아가는 코드는 만들기는 쉽지만 변화하는 환경과 요구 사항에도 불구하고 계속 작동하는 코드를 만드는 것이 더 어려움
- 나중에 생각하거나 이후에 몇 가지 테스트를 추가하면 될 것이라고 가정하는 것은 효과적인 접근법이 아님

### 코드는 변경된 요구 사항에 적응할 수 있어야 한다

- 요구 사항은 계속 변함
  - 비즈니스 환경이 변함
  - 사용자 선호가 변함
  - 가정이 더 이상 유효하지 않음
  - 새로운 기능이 계속 추가됨
- 적용 가능한 코드를 작성하기 위해 얼마나 많은 노력을 기울여야 할지에 대해 균형 잡힌 결정을 내리는 것은 까다로움
- 코드나 소프트웨어가 시간이 지남에 따라 어떻게 변할지 완벽하고 정확하게 예측하는 것은 불가능

### 코드는 이미 존재하는 기능을 중복 구현해서는 안 된다

- 시간과 노력을 절약
- 버그 가능성을 줄임
- 기존 전문지식을 활용
- 코드가 이해하기 쉬움

------------

## 코드 품질의 핵심 요소

### 코드는 읽기 쉬워야 한다

- 코드를 읽을 때 다음과 같은 사항을 이해하기 위해 애씀
  - 코드가 하는 일
  - 어떻게 그 일을 수행하는지
  - (입력이나 상태 등) 어떤 것을 필요로 하는지
  - 코드 실행 결과물
- 코드의 가독성이 떨어진다면 다른 개발자가 그 코드를 이해하는 데 많은 시간을 들여야 함
  - 코드 검토 중에 버그를 발견할 가능성이 작아짐
  - 새로운 기능을 추가하기 위해 다른 사람이 코드를 수정할 때 새로운 버그가 도입될 가능성이 큼

### 코드는 예측 가능해야 한다

- 우리의 코드를 사용하는 다른 개발자는 이름, 데이터 유형, 일반적인 관행과 같은 단서를 사용해 코드가 입력값으로 무엇을 예상하는지,
코드가 무슨 일을 하는지, 무엇을 반환하는지에 대한 정신 모델을 구축함
- 정신 모델과 어긋나는 어떤 일이 코드에서 일어나면, 버그가 아무도 모르게 코드 내로 유입되는 일이 많이 일어남

### 코드를 오용하기 어렵게 만들라

- 작성한 코드에 잘못된 것들이 꽂히면, 모든 것이 폭발할 수 있음
  - 별 문제가 없을 수도 있지만 중요한 데이터가 손실될 수도 있음

### 코드를 모듈화하라

- 모듈화는 개체나 시스템의 구성 요소가 독립적으로 교환되거나 교체될 수 있음을 의미함
- 모듈화된 시스템의 주요 특징 중 하나는 인터페이스가 잘 정의되어 서로 다른 구성 요소 간 상호작용하는 지점이 최소화된다는 점
- 코드를 외부에 의존하지 않고 실행할 수 있는 모듈로 나누는 것이 이로울 때가 많음
  - 인접한 모듈 사이의 상호작용은 한 곳에서 일어나고 잘 정의된 인터페이스를 사용함
  - 변화하는 요구 사항에 더 쉽게 적응할 수 있는 코드를 작성하는 데 도움이 됨
    - 한 가지 기능을 변경한다고 해서 다른 부분까지 변경할 필요가 없기 때문

### 코드를 재사용 가능하고 일반화할 수 있게 작성하라

- 재사용성(reusability)은 어떤 문제를 해결하기 위한 무언가가 여러 가지 다른 상황에서도 사용될 수 있음을 의미
  - 핸드 드릴은 벽, 바닥 판 및 천장에 구멍을 뚫는 데 사용함
  - 문제는 동일(드릴로 구멍을 뚫어야함)하지만 상황은 다름(벽, 바닥, 천장)
- 일반화성(generalizability)은 개념적으로는 유사하지만 서로 미묘하게 다른 문제들을 해결할 수 있음을 의미
  - 핸드 드릴은 구멍을 뚫는 데 사용될 뿐만 아니라 나사를 박을 때도 사용될 수 있어 일반화성을 갖음
- 코드를 만들어 내는 데 시간과 노력이 필요하며 일단 만들어지면 유지보수에 지속적인 시간과 노력이 들어감
  - 코드베이스에서 코드 라인이 적으면 적을수록 좋음
- 코드를 재사용할 수 있고 일반화되어 있으면 코드를 코드베이스의 여러 부분에서 사용할 수 있고 여러 가지 문제를 해결할 수 있음
  - 시간과 노력을 절약해주고 더 신뢰할 수 있음

### 테스트가 용이한 코드를 작성하고 제대로 테스트하라

- 테스트는 프로세스에서 두 가지 핵심 사항에 대한 주된 방어 수단이 될 때가 많음
  - 버그나 제대로 동작하지 않는 기능을 갖는 코드가 코드베이스에 병합되지 않도록 방지
  - 버그나 제대로 동작하지 않는 기능을 갖는 코드가 배포되지 않도록 막고 서비스 환경에서 실행되지 않도록 보장
- 테스트로 코드의 기능을 견고하게 만들지 않으면 문제들이 발생함
- 테스트
  - 단위 테스트(unit test)
    - 개별 함수나 클래스와 같은 작은 단위의 코드를 테스트
    - 개발자가 일상 코딩에서 가장 자주 작업하는 수준의 테스트
  - 통합 테스트(integration test)
    - 여러 구성 요소들이 제대로 작동하고 멈추지 않고 계속 실행하는지 확인 가능
  - 종단간 테스트(end-to-end E2E test)
    - 처음부터 끝까지 전체 소프트웨어 시스템에서 작동의 흐름을 테스트
- 테스트 용이성
  - 테스트 대상이 되는 실제 코드를 가리키며 해당 코드가 얼마나 테스트하기 적합한지를 나타냄
  - 테스트 용이성은 서브시스템이나 시스템 수준에도 적용될 수 있음
  - 모듈화와 깊은 관련이 있음
    - 모듈화된 코드는 테스트 용이성이 좋음
    - 모듈화 되지 않으면 계속 종단간 테스트, 통합 테스트를 해야 하기 때문에 비용이 커짐

-----------

## 고품질 코드 작성은 일정을 지연시키는가?

- 단기적으로는 고품질 코드를 작성하는 데 시간이 더 걸릴 수 있지만 중장기적으로는 개발 시간을 단축해줌
- 코드 품질을 고려하지 않고 먼저 떠오르는 대로 코딩하면 처음에는 시간을 절약할 수 있지만 머지않아 취약하고 복잡한
코드베이스로 귀결될 것이며 점점 더 이해하기 어렵고 추론할 수 없는 코드가 됨

---------

## 요약

- 좋은 소프트웨어를 만들려면 고품질 코드를 작성해야 함
- 실제 서비스 환경에서 실행되는 소프트웨어가 되기 전에 코드는 일반적으로 여러 단계의 검사와 테스트를 통과해야 함
- 버그나 제대로 동작하지 않는 기능이 사용자에게 제공되거나 비즈니스에 중요한 시스템에서 실행되는 것을 이러한 검사를 통해 막을 수 있음
- 테스트는 코드를 작성하는 모든 단계에서 고려하는 것이 좋음
- 고품질 코드를 작성하면 처음에는 시간이 오래 걸리지만 중장기적으로는 개발 시간이 단축되는 경우가 많음
