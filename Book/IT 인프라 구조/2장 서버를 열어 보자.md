# 서버를 열어 보자

------------------

## 물리 서버

### 서버 외관과 설치 장소

- 서버는 랙(Rack)이라는 것에 장착된다.
- 랙에는 서버 외에도 HDD가 가득 장착돼 있는 저장소나 인터넷 및 LAN을 연결하기 위한 네트워크 스위치 등도 탑재되어 있다.
- 대부분의 랙은 폭이 19인치며, 높이는 한 칸에 약 4.5cm로 40~46개 칸으로 이루어져 있다. 이 한 칸을 1U라고 하며, 서버 높이는 이 단위를
따르고 있다. 2U 서버는 높이 약 9cm의 서버임을 의미한다.
  - 데이터 센터의 물리적인 공간을 고려해 2U 혹은 1U로 설정한다. 1U는 크기가 작지만 성능이 줄어드는 측면이 있으므로 잘 고려해야 한다.
- 전원이나 네트워크 케이블 배선 등은 모두 랙 뒷면에서 연결된다.
- 서버 설치 시 중요한 정보
  - 서버 크기(U)
  - 소비 전력(A)
  - 중량(kg)

### 서버 내부 구성

- 서버는 위쪽 뚜겅을 열 수 있고, 열면 PC 부품과 같은 종류가 들어 있다.
- 컴포넌트들은 버스(BUS)로 연결된다.
- 서버와 PC는 물리적으로 기본 구성이 같다. 전원이 이중화돼 있어서 장애에 강하거나 대용량 CPU나 메모리가 탑재돼 있는 정도가 PC와의 차이점이다.
- 하드웨어 제조사가 경쟁하는 것은 CPU나 메모리 등의 컴포넌트 자체를 개선하거나 컴포넌트 배치나 버스 구성, 하드웨어를 가동시키기 위한 펌웨어를 개선해서
성능을 차별화 하는 것이다.

----------------

## CPU

- CPU는 Central Processing Unit의 약자다.
- 서버 중심에 위치해서 연산 처리를 실시한다.
- 표면에는 대량의 전기 신호를 처리하기 때문에 발열이 심하며 이 부분에 보통 냉각기가 설치된다.
- 뒷면은 시스템 포트에 장착돼 있어서 보이지 않으며 주변을 감싸고 있는 대량의 핀이 버스에 연결돼 있어서 메모리나 디스크와 데이터를 교환한다.
- 현재는 CPU를 '코어(core)'라고 하며, 하나의 CPU에 여러 개의'코어'가 존재하는 멀티 코어화가 진행되고 있다.
- 명령이나 데이터는 기억 장치에 있고, 명령은 운영체제(Operating System, OS)가 내린다.
- OS에 명령을 내리는 것은 웹 서버나 데이터베이스의 실체인 '프로세스'와 사용자 키보드, 마우스 등을 통한 입력이지 CPU가 자발적으로 처리하는 것은 아니다.

---------------

## 메모리

- 메모리는 그 명칭 그대로 기억 영역을 말한다.
- CPU 옆에 위치하며 CPU에 전달하는 내용이나 데이터를 저장하거나 처리 결과를 받는다
- 메모리에 저장되는 정보는 영구성이 없다. 영구성이 없다는 것은 서버를 재시작하면 없어지는 정보임을 의미한다. 하지만 이러한 결점에도 메모리를 사용하는
이유는 메모리 액세스가 매우 빠르게 이루어지기 때문이다. 그리고 데이터 저장 시에 물리적인 모터 등을 구동하는 것이 아니라 전기적인
처리만으로도 데이터를 저장하기 때문이다.
- CPU 자체도 메모리를 가지고 있다. 이것은 레지스터나 1차(L1)/2차(L2) 캐시라고 불리며 CPU 내부에 존재한다. 메모리보다 빠르긴 하지만 용량이 매우 작다.

-------------

## I/O 장치

### 하드 디스크 드라이브(HDD)

- 서버에서는 메모리에 비해 CPU에서 떨어진 곳에 배치되며 주로 장기 저장 목저의 데이터 저장 장소로 사용한다.
- 메모리도 디스크도 기억 영역이지만 엑세스 속도가 다르며, 전기가 흐르는지 여부에 따라 데이터가 손실되거나 손실되지 않거나 하는 점이 다르다.
  - 메모리는 전기가 흐르지 않으면 데이터가 손실되며, 디스크는 전기가 없어도 데이터가 손실되지 않는다.
- HDD 내부에는 자기 원반이 여러 개 들어 있으며, 이것이 고속으로 회전해서 읽기/쓰기 처리를 한다. CD나 DVD와 같은 구조다.
- 회전 구조 때문에 속도가 물리 법칙에 좌우되며, 메모리처럼 순식간에 액세스할 수 없다.
- 최근에는 기술이 발달해서 SSD(Solid State Disk, 반도체 디스크)라는 물리적인 회전 요소를 사용하지 않는 디스크가 사용되고 있다. 메모리와 같은 반도체
로 만들어졌지만, 전기가 없어도 데이터가 사라지지 않는다.
- HDD가 많이 탑재돼 있는 하드웨어를 스토리지(Storage, 저장소)라고 한다.
- 서버와 I/O 시에는 HDD가 직접 데이터 교환을 하는 것이 아니라 캐시를 통해서 한다.
  - 읽기 캐시
    - 캐시에 존재하지 않는 경우는 디스크에서 읽어서 캐시에 올리고 이를 서버에 반환.
    - 캐시에 존재하는 경우엔 캐시에서 꺼냄
  - 쓰기 캐시
    - 라이트 스루: 캐시와 저장소에 기록하고 I/O를 종료했다고 서버에 알림
    - 라이트 백: 캐시에 기록하고 I/O를 종료했다고 서버에 알림
- 대형 저장소와 연결할 때는 일반적으로 파이버 채널(Bivre Channel, FC)라는 케이블을 사용해서 SAN(Storage Area Network)라는 네트워크를
경유 한다.
- 라이트 백의 경우 캐시에만 데이터를 기록하고 완료했다고 간주하여 데이터를 잃을 가능성이 있지만 캐시에 저장해서 쓰기 처리가 종료되기 때문에 고속I/O를 시렿ㄴ할 수 있고,
대부분의 저장소 제품에서는 이 캐시를 별도의 캐시와 미러링해서 안정성을 높이고 있다.
- 캐시와 HDD 모두 엑세스하는 라이트 스루는 캐시의 장점이 없다.

### 네트워크 인터페이스

- 서버와 외부 장비를 연결하기 위한 것으로 외부 접속용 인터페이스다.
- 서버 외부 장비로는 네트워크에 연결된 다른 서버나 저장소 장치가 있다.

----------------------

## 버스

- 버스(Bus)는 서버 내부에 있는 컴포넌트들을 서로 연결시키는 회선을 가리킨다.
- 버스에서 중요한 것은 어느 정도의 데이터 전송 능력을 가지고 있는가, 즉 대역이 어느 정도인가가 중요하다.

### 대역

- 대역이란 원래 주파수 대역을 가리키지만 IT 인프라에서는 데이터 전송 능력을 의미한다.
- 대역은 '한번에 데이터를 보낼 수 있는 데이터의 폭(전송폭)' * '1초에 전송할 수 있는 횟수(전송 횟수)'로 결정된다.
- 전송 횟수는 '1초 / 1 처리당 소요 시간(응답 시간)'으로 표현할 수 있다.
- 대역은 '스루풋(Throughput, 처리량)'이라고도 부른다.
- 예를 들어 인터페이스 규격의 하나인 PCI Express 3.0은 1회선당 2GB/s(편방향 1GB/s) 전송이 가능한 프로토콜이다.

### 버스 대역

- CPU에 가까운 쪽이 버스 대역이 크다.
  - CPU와 메모리는 대량으로 데이터를 교환해서 매우 빠른 전송 능력이 요구되기 때문.
  - USB 3.0 포트는 약 500MB/s 전송 능력을 가진 규격으로 저속이기 때문에 멀리 배치해도 상관없음.
- 버스 흐름에서 중요한 것은 CPU와 장치 사이에 병목 현상이 없어야 한다는 것이다.
  - 병목 현상(Bottleneck)은 데이터 전송이 어떤 이유로 막혀 있는 상태를 의미한다.
- 시스템 설계 시에 특히 놓치기 쉬운 것이 외부 장치 연결 시의 버스 대역에 관한 것이다.
  - PCI Express 3.0 슬롯의 x16(편방향 16GB/s)과 x8(편방향 8GB/s)에서는 전송 능력 차이가 두 배가 된다. SAS 3.0 HDD의 전송 능력은
  1200MB/s이기 때문에 단순히 x8 슬롯에서는 7회선 이상 HDD가 동시에 I/O를 하면 PCI 버스에 병목 현상이 발생한다.
    - 1.2GB * 7 = 8.4GB(7개의 HDD) > x8(8GB)

------------------

## 정리

- 하드웨어는 시스템의 가장 기반이 되는 부분이다.
- 애플리케이션이나 OS는 이 하드웨어를 움직이기 위한 프로그램의 집합이라 할 수 있다.
- 프로그램이 동작하면 하드웨어가 어떤 식으로 동작하는지 이해한 후 이것을 바탕으로 새로운 구조나 시스템을 만드는 것이
진정한 IT 엔지니어다.