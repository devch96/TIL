# JSP 기본

--------

## 동적 웹 페이지로의 여정과 JSP

- JSP란 동적 웹 페이지를 쉽고 빠르게 제작할 수 있도록 자바가 제시한 궁극적 해법

### 정적 웹 페이지와 동적 웹 페이지

- 정적 웹 페이지란 웹 서버에 저장되어 있는 파일을 그대로 웹 브라우저에 전송해 출력하는 가장 기본적인 웹 페이지
  - 클라이언트가 어떤 형태로 요청하더라도 같은 페이지는 항상 동일한 모습을 보여줌
- 동적 웹 페이지란 동일한 페이지라 할지라도 그때그때 내용이 달라질 수 있는 웹 페이지
  - 서버가 클라이언트의 요청을 해석하여 가장 적절한 웹 페이지를 그때그때 생성해 보내주는 기술
  - 동적 웹 페이지는 '전처리' 과정을 거쳐 응답 페이지를 동적으로 생성함
  - 전처리를 어떻게 하느냐에 따라 구체적인 동적 웹 페이지 기술이 나뉨
    - JSP와 서블릿
    - ASP와 PHP 등

### 애플릿, 동적 웹을 향한 자바의 첫걸음

- 웹을 동적으로 만들기 위한 고대의 자바 기술
  - 자바 애플릿(Java Applet)
- 자바 애플릿은 웹에서 실행되도록 설계된 자바 애플리케이션을 통째로 웹 브라우저로 전송한 후, 자바 가상 머신을 탑재한 웹 브라우저가
이를 실행하는 방식으로 구동됨
- 표준 기술인 HTML과 자바스크립트가 발전하면서 지금은 더 이상 지원되지 않음

### 서블릿, 자바 웹 기술의 새 지평을 열다

- 애플리케이션 전체가 클라이언트에 다운로드된 후 실행되는 자바 애플릿은 속도, 보안, 유연성 등에서 한계가 있었음
- 서버 측에서 실행되는 서블릿(Servlet)이 등장함
- 서블릿은 클라이언트의 요청을 받으면 서버에서 처리한 후 응답으로는 결괏값만 보내주는 구조
- 서블릿은 자바 파일(.java)를 컴파일한 클래스 파일(.class) 형태이며 이를 실행하고 관리해주는 런타임을 서블릿 컨테이너라고 함
  - 아파치 톰캣

### JSP, 자바 웹 기술의 최종 진화

- 서블릿은에도 단점은 있었음
  - 기본적으로 자바 코드인데 결과로 보여줄 HTML 코드를 일일이 자바로 생성,조합하다보니 너무 많은 코드가 필요함
- 발상을 전환하여 기본을 HTML로 하고 필요한 부분만 자바 코드를 삽입하는 형태인 JSP가 탄생
- JSP 파일을 서블릿으로 변환하여 서블릿을 실행하는 방식임
  - 한 번 서블릿으로 컴파일된 JSP 파일은 캐시되므로 성능 저하 없이 개발 생산성과 유지보수 편의성 모두 얻음
- JSP가 서블릿으로 변환되어 실행된다는 것은 서블릿 기술도 여전히 사용할 수 있다는 뜻
  - JSP는 클라이언트에 보여지는 결과 페이지를 생성할 때 주로 쓰이며 서블릿은 UI 요소가 없는 제어나 기타 처리 용도로 쓰임
- 서블릿
  - 자바 코드 안에 전체 HTML 페이지 생성
  - 변수 선언 및 초기화가 반드시 선행되어야 함
  - 컨트롤러를 만들 때 사용
- JSP
  - HTML 코드 안에서 필요한 부분만 자바 코드를 스크립트 형태로 추가
  - 자주 쓰이는 기능을 내장 객체로 제공하여 즉시 사용할 수 있음
  - 처리된 결과를 보여주는 뷰를 만들 때 사용

--------------

## JSP 파일 기본 구조

```html
// 지시어
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>

// 스크립트 요소(선언부)
<%!
String str1 = "JSP";
String str2 = "안녕하세요";
%>
<!DOCTYPE html>
<html>
<head>
  <title>JSP - Hello World</title>
</head>
<body>
<h2>처음 만들어보는 <%= str1 %></h2> // 스크립트 요소(표현식)
<p>
  <%
  out.println(str2 + str1 + "입니다."); // 스크립트 요소(스크립틀릿)
  %>
</p>
</body>
</html>
```

----------

## 지시어(Directive)

- 지시어는 JSP 페이지를 자바(서블릿) 코드로 변호나하는 데 필요한 정보를 JSP 엔진에 알려줌
  - 주로 스크립트 언어나 인코딩 방식 등을 설정함
  - 지시자 혹은 디렉티브로 부르기도 함

```html
<%@ 지시어종류 속성1="값1" 속성2="값2" ... %>
```

### page 지시어

- JSP 페이지에 대한 정보를 설정함
  - 문서의 타입, 에러 페이지, MIME 타입과 같은 정보 설정

#### import 속성

- 자바에서 외부 클래스를 사용하려면 import 문으로 해당 패키지나 클래스를 가져와야 하듯이 JSP 파일에서도
필요한 클래스가 있으면 임포트해야 함
  - java.lang 패키지에 속하지 않은 클래스를 JSP 문서에서 사용하기 위해 사용

```html
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ page import="java.text.SimpleDateFormat"%>
<%@ page import="java.util.Date" %>
<html>
<head>
    <title>page 지시어 - import 속성</title>
</head>
<body>
<%
    Date today = new Date();
    SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
    String todayStr = dateFormat.format(today);
    out.println("오늘 날짜 : " + todayStr);
%>
</body>
</html>
```

#### errorPage, isErrorPage 속성

- JSP는 실행 도중 에러가 발생하면 HTTP Status 500 에러 화면을 웹 브라우저에 표시해 줌
  - 개발을 진행중이라면 좋지만 실제 서비스는 안좋음
- 개발자가 지정한 JSP 화면을 보여주는 방법

```html
<% page errorPage="IsErrorPage.jsp" %>
```

- 실제 에러 페이지

```html
<% page isErrorPage="true"%>
```

- isErrorPage 속성을 true로 설정해주어야 발생된 에러 내용을 그대로 넘겨받을 수 있음

#### trimDirectiveWhitespaces 속성

- 페이지에서 마우스 우클릭 -> 페이지 소스 보기를 클릭해서 보면 상단에 항상 공백이 있음
  - page 지시어가 있던 부분
  - 웹 서버에서 처리도니 후 공백으로 남음
- 일반적으로 큰 문제가 없지만 안드로이드와 같은 외부 기기와 연동 시 가끔 문제를 일으키기도 함
- 지시어 때문에 생성된 불필요한 공백을 제거할 때 사용

```html
<%@ page trimDirectiveWhitespaces="true %>
```

#### buffer, autoFlush 속성

- JSP 파일은 서블릿 코드로 변환된 후 컴파일되어 class 파일로 만들어진 다음 이를 실행한 결과물을 HTML 형태로 웹 브라우저에 보내
최종적으로 화면에 출력하는 것
- 이 과정에서 응답 결과를 웹 브라우저로 즉시 전송하지 않고 출력할 내용을 버퍼에 저장했다가 일정량이 되었을 때 전송하게 됨
- JSP에서는 버퍼를 사용함으로써 포워드와 에러 페이지 처리를 할 수 있음
  - JSP가 생성한 결과는 버퍼에 저장되고 만약 실행 도중 에러가 발생하면 버퍼에 저장된 내용을 삭제하고
  에러 화면을 표시함
- buffer 속성으로는 버퍼의 크기를 설정할 수 있음 (기본값 8kb)

```html
<%@ page buffer="1kb" %>
<%@ page buffer="none" %>
```
- 버퍼를 사용하지 않으면 포워드나 에러 페이지 기능을 사용할 수 없기 때문에 none으로 지정하는 경우는 거의 없음
- autoFlush 속성은 버퍼가 모두 채워졌을 때의 처리 방법을 정하는 데 쓰임
  - true와 false
  - true(기본값): 버퍼가 채워지면 자동으로 플러시
  - false: 버퍼가 채워지면 예외를 발생

### include 지시어

- 반복되는 부분을 별도의 파일에 작성해두고 필요한 페이지에서 include 지시어로 포함시킬 수 있음

```html
<%@ include file="포함할 파일의 경로"%>
```
- include 지시어로 다른 문서를 포함시키면 먼저 '파일의 내용 그대로를 문서에 삽입'한 후 '컴파일'이 진행됨.
  - 하나의 페이지가 됨

### taglib 지시어

- EL(표현 언어)에서 자바 클래스의 메서드를 호출하거나 JSTL을 사용하기 위한 지시어

------------

## 스크립트 요소(Script Elements)

- JSP에서 자바 코드를 직접 작성할 수 있게 해줌
- 용도에 따라 선언부, 스크립틀릿, 표현식이 있음
- JSP는 실행될 때 서블릿으로 변환되고 클래스로 컴파일된 후 응답함. 이 변환 과정에서 _jspService() 메서드가 생성되는데 변환된 코드의 위치는 스크립트 요소에 따라
_jspService()메서드 내부 혹은 외부에 놓일 수 있음

### 선언부(Declaration)

- 스크립틀릿이나 표현식에서 사용할 멤버 변수나 메서드를 선언함
- 서블릿으로 변환 시 _jspService() 메서드 외부에 선언됨

```html
<%! 메서드 선언 %>
```

### 스크립틀릿(Scriptlet)

- JSP 페이지가 요청을 받을 때 실행돼야 할 자바 코드를 작성하는 영역
- 서블릿으로 변환 시 _jspService() 메서드 내부에 그대로 기술됨

```html
<% 자바 코드 %>
```
- 자바는 메서드 내부에 다른 메서드를 선언하는 게 불가(중첩 메서드)
- 스크립틀릿에 메서드를 선언한다면 에러가 발생함
  - _jspService()에 메서드를 선언하는 꼴

### 표현식(Expression)

- 표현식이란 실행 결과로 하나의 값이 남는 문장
  - 상수, 변수, 연산자를 이용한 (수)식, 반환값이 있는 메서드 호출 등
- JSP의 표현식도 이와 마찬가지로 주로 변수의 값을 웹 브라우저 화면에 출력할 때 사용함

```html
<%= 자바 표현식 %>
```

### 스크립트 요소 활용

```html
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%!
    public int add(int num1, int num2) {
        return num1 + num2;
    }
%>
<html>
<head>
    <title>스크립트 요소</title>
</head>
<body>
<%
    int result = add(10,20);
%>
덧셈 결과 1 : <%= result %><br>
덧셈 결과 2 : <%= add(30,40)%>
</body>
</html>
```

### 핵심 요약

- 지시어
  - page: JSP 페이지에 대한 문서의 타입, 에러 페이지, MIME 타입과 같은 정보들을 설정
  - include: JSP에서 또 다른 JSP나 HTML 페이지를 포함시킬 때 사용
  - taglib: EL(표현 언어)에서 자바 클래스의 메서드를 호출하거나 JSTL을 사용하기 위해 선언
- 스크립트 요소
  - 선언부: 멤버 변수나 메서드를 선언할 때 사용하는 영역
    - %!
  - 스크립틀릿: 선언부에서 선언된 메서드를 호출하거나 자바 코드를 작성하는 영역
    - %
  - 표현식: 주로 변수의 값을 간단하게 출력할 때 사용
    - %=