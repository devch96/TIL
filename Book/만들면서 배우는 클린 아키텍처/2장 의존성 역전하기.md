# 의존성 역전하기

--------

## 단일 책임 원칙

- 하나의 컴포넌트는 오로지 한 가지 일만 해야하고, 그것을 올바르게 수행해야 한다.
- 컴포넌트를 변경하는 이유는 오직 하나뿐이어야 한다.
- 단일 변경 이유 원칙
- 컴포넌트를 변경할 이유가 한 가지라면 우리가 어떤 다른 이유로 소프트웨어를 변경하더라도 이 컴포넌트에 대해서는 전혀 신경 쓸 필요가 없음
  - 여전히 기대한 대로 동작할 것이기 때문
- 하지만 변경의 이유라는 것은 컴포넌트 간의 의존성을 통해 너무도 쉽게 전파됨
- 많은 코드는 단일 책임 원칙을 위반하기 때문에 시간이 갈수록 변경하기가 더 어려워지고 그로 인해 변경 비용도 증가

-----------

## 의존성 역전 원칙

- 계층형 아키텍처에서 계층 간 의존성은 항상 다음 계층인 아래 방향을 가리킴
- 단일 책임 원칙을 고수준에서 적용할 때 상위 계층들이 하위 계층들에 비해 변경할 이유가 더 많다
  - 영속성 계층에 대한 도메인 계층의 의존성 때문에 영속성 계층을 변경할 때마다 잠재적으로 도메인 계층도 변경해야 함
- 도메인 코드는 애플리케이션에서 가장 중요한 코드기 때문에 영속성 코드가 바뀐다고 해서 도메인 코드까지 바꾸고 싶진 않음
  - 의존성 역전 원칙을 사용
- 코드상의 어떤 의존성이든 그 방향을 바꿀 수 있음

------------

## 클린 아키텍처

- 클린 아키텍처에서는 설계가 비즈니스 규칙의 테스트를 용이하게 하고, 비즈니스 규칙은 프레임워크, 데이터베이스, UI 기술, 그 밖의 외부 애플리케이션이나
인터페이스로부터 독립적일 수 있다.
  - 도메인 코드가 바깥으로 향하는 어떤 의존성도 없어야 함을 의미
  - 의존성 역전 원칙의 도움으로 모든 의존성이 도메인 코드를 향해야 함
- 클린 아키텍처에는 도메인 계층이 영속성이나 UI같은 외부 계층과 철저하게 분리돼야 하므로 애플리케이션의 엔티티에 대한 모델을 각 계층에서 유지보수해야 함
  - 영속성 계층에서 ORM 프레임워크를 사용한다 가정
  - ORM은 엔티티 클래스를 필요
  - 도메인 계층은 영속성 계층을 모르기 때문에 도메인 계층에서 사용한 엔티티 클래스를 영속성 계층에서 함께 사용할 수 없도 두 계층에서 각각 엔티티를 만들어야 함
    - 도메인 계층과 영속성 계층이 데이터를 주고받을 때 두 엔티티를 서로 변환해야 함
- 이 대가는 바람직한 일
  - 도메인 코드를 프레임워크에 특화된 문제로부터 해방시킴
- JPA에서는 ORM이 관리하는 엔티티에 인자가 없는 기본 생성자를 추가하도록 강제함
  - 도메인 모델에는 포함해서는 안 될 프레임워크에 특화된 결합

--------------

## 육각형 아키텍처(헥사고날 아키텍처)

- 애플리케이션 코어가 육각형으로 표현
- 육각형 안에는 도메인 엔티티와 이와 상호작용하는 유스케이스가 있음
- 육각형에서 외부로 향하는 의존성이 없음
  - 모든 의존성이 육각형을 향함
- 육각형 바깥에는 애플리케이션과 상호작용하는 다양한 어댑터들이 있음
  - 웹 어댑터, 외부 시스템 어댑터, 데이터베이스 어댑터 등
  - 왼쪽에 있는 어댑터는 애플리케이션 코어를 호출하기에 애플리케이션을 주도하는 어댑터
    - 웹, 외부 시스템 ...
  - 오른쪽에 있는 어댑터는 애플리케이션 코어에 의해 호출되기 때문에 애플리케이션에 의해 주도되는 어댑터
    - 영속성, 외부 시스템 ...
- 애플리케이션 코어와 어댑터들 간의 통신이 가능하려면 애플리케이션 코어가 각각의 포트를 제공해야 함
  - 주도하는 어댑터(driving adapter)에게는 그러한 포트가 코어에 있는 유스케이스 클래스 중 하나에 의해 구현되고 어댑터에 의해 호출되는 인터페이스가 됨
  - 주도되는 어댑터(driven adapter)에게는 그러한 포트가 어댑터에 의해 구현되고 코어에 의해 호출되는 인터페이스가 됨

--------------

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 변경할 이유가 적을수록 유지보수성은 더 좋아진다.
- 도메인 코드는 비즈니스 문제에 딱 맞도록 자유롭게 모델링될 수 있고, 영속성 코드와 UI 코드도 영속성 문제와 UI 문제에 맞게 자유롭게 모델링될 수 있다.
