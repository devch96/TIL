# 웹 어댑터 구현하기

- 헥사고날 아키텍처에서 외부 세계와의 모든 커뮤니케이션은 어댑터를 통해 이루어짐

---------

## 의존성 역전

- 웹 어댑터는 '주도하는', '인커밍' 어댑터다.
  - 외부로부터 요청을 받아 애플리케이션 코어를 호출하고 무슨 일을 해야 할지 알려준다.
  - 제어 흐름은 웹 어댑터에 있는 컨트롤러에서 애플리케이션 계층에 있는 서비스로 흐른다.
- 애플리케이션 계층은 웹 어댑터가 통신할 수 있는 특정 포트를 제공
  - 서비스는 이 포트를 구현, 웹 어댑터는 이 포트를 호출
- 의존성 역전 원칙이 적용된 것
- 웹 어댑터와 유스케이스 사이에 간접 계층을 넣은 이유는 애플리케이션 코어가 외부 세계와 통신할 수 있는 곳에 대한
명세가 포티이기 때문
  - 포트를 적절한 곳에 위치시키면 외부와 어떤 통신이 일어나고 있는지 알 수 있다
- 밖으로 나가는 포트는 웹 어댑터에서 구현하고 애플리케이션 코어에서 호출해야 함
  - 아웃고잉 포트

-------------

## 웹 어댑터의 책임

- 웹 어댑터는 일반적으로 다음과 같은 일을 함
  - HTTP 요청을 자바 객체로 매핑
  - 권한 검사
  - 입력 유효성 검증
  - 입력을 유스케이스의 입력 모델로 매핑
  - 유스케이스 호출
  - 유스케이스 출력을 HTTP로 매핑
  - HTTP 응답을 반환
- 웹 어댑터가 하는 일이 많아보이나 이 책임들은 애플리케이션 계층이 신경 쓰면 안 되는 것들이다.
  - 애플리케이션이 HTTP을 다루고 있다는 것을 알게 되면 다른 인커밍 어댑터의 요청에 대해 동일한 도메인 로직을 수행할 수 있는
  선택지를 잃게 됨
  - 좋은 아키텍처에서는 선택의 여지를 남겨놔야 함
- 웹 어댑터와 애플리케이션 계층 간의 경계는 웹 계층에서부터 개발을 시작하는 대신 도메인과 애플리케이션 계층부터 개발하기 시작하면 자연스럽게 생김
  - 특정 인커밍 어댑터를 생각할 필요 없이 유스케이스를 먼저 구현하면 경계를 흐리게 만들 유혹에 빠지지 않을 수 있음

------------

## 컨트롤러 나누기

- 자바의 스프링 MVC 같은 대부분의 웹 프레임워크에서는 웹 어댑터의 책임들을 수행할 컨트롤러 클래스를 생성할 수 있다.
  - 모든 요청에 응답할 수 있는 하나의 컨트롤러?
  - 한 개 이상의 클래스로 구성해도 됨
- 하지만 클래스들이 같은 소속이라는 것을 표현하기 위해 같은 패키지 수준에 놓아야 함
- 컨트롤러의 적정 수준은 몇개?
  - 너무 적은 것보다는 너무 많은 게 남
  - 컨트롤러가 가능한 한 좁고 다른 컨트롤러와 가능한 한 적게 공유하는 웹 어댑터 조각을 구현해야 함
- 자주 사용되는 방식(컨트롤러 하나를 만들어서 관련된 모든 요청을 받는 것)
```java
@RestController
@RequiredArgsConstructor
public class AccountController {
    ...
    
    @GetMapping("/accounts")
    ...
    @GetMapping("/accounts/{accountId}")
    ...
}
```
- 특정 리소스와 관련된 모든 것이 하나의 클래스에 모여 있으면 괜찮아 보이지만 단점이 있다.
  - 클래스마다 코드는 적을수록 좋다
    - 코드의 줄이 늘어날수록 파악하는 것의 난이도가 높아진다
    - 테스트 코드도 코드의 줄이 늘어날수록 늘어나기 때문에 파악하기 어려워진다
  - 모든 연산을 단일 컨트롤러에 넣는 것이 데이터 구조의 재활용을 촉진한다
    - 많은 연산들이 모델 클래스를 공유하기 때문에 다른 연산에서 필요없는 데이터를 갖고 있을 수 있다.
    - 연산 과정을 파악하는데 있어서 도움이 되기보다 헷갈릴 수 있음
- 저자는 가급적 별도의 패키지 안에 별도의 컨트롤러를 만드는 방식을 선호
  - 가급적 메서드와 클래스명은 유스케이스를 최대한 반영해서 지어야 함
- 이렇게 하면 전용 모델 클래스들은 컨트롤러의 패키지에 대해 private으로 선언할 수 있기 때문에 실수로 다른 곳에서 재사용될 일이 없음

--------------

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 애플리케이션의 웹 어댑터를 구현할 때는 HTTP 요청을 애플리케이션의 유스케이스에 대한 메서드 호출로 변환하고 결과를 다시 HTTP로 변환하되 어떠한 도메인
로직도 수행하지 않는 어댑터를 만들고 있다는 점을 염두에 둬야 함
- 애플리케이션 계층은 HTTP에 대한 상세 정보를 노출시키지 않도록 HTTP 관련된 작업을 해서는 안됨
  - 이러면 HTTP가 아닌 다른 어댑터로 쉽게 교체 가능
- 웹 컨트롤러를 나눌 때는 모델을 공유하지 않는 여러 작은 클래스들을 만드는 것을 두려워해서는 안 됨
  - 작은 클래스들은 더 파악하기 쉽고, 더 테스트하기 쉬우며, 동시 작업을 지원함
- 세분화된 컨트롤러를 만드는 것은 처음에는 족므 더 공수가 들겠지만 유지보수하는 동안에는 빛을 발함
