# 경계 간 매핑하기

- 매퍼 구현을 피하기 위해 두 계층에서 같은 모델을 사용하는 것에 대해 논의
  - 매핑에 찬성하는 개발자
    - 두 계층 간에 매핑을 하지 않으면 양 계층에서 같은 모델을 사용해야 하는데 이렇게 하면 두 계층이 강하게 결합된다.
  - 매핑에 반대하는 개발자
    - 두 계층 간에 매핑을 하게 되면 보일러플레이트 코드를 너무 많이 만든다.
    - 많은 유스케이스들이 CRUD만 수행하고 계층에 걸쳐 같은 모델을 사용하기 때문에 계층 사이의 매핑은 과하다

-----------

## '매핑하지 않기' 전략

- 웹 계층과 영속성 계층은 모델에 대한 특별한 요구사항이 있을 수 있다.
  - 웹 계층에서 REST로 모델을 노출시켰다면 모델을 JSON으로 직렬화하기 위한 애너테이션을 모델 클래스의
  특정 필드에 붙여야 할 수도 있다.
  - 영속성 계층에서는 ORM 프레임워크를 사용한다면 데이터베이스 매핑을 위한 특정 애너테이션이 필요할 것
- 매핑을 하지 않으면 도메인과 애플리케이션 계층은 웹이나 영속성과 관련된 특수한 요구사항에 관심이 없음에도 불구하고 도메인 모델 클래스는 이런 모든 
요구사항을 다뤄야 함
  - 단일 책임 원칙을 위반함
- 지저분하게 느껴질 수는 있지만 매핑하지 않기 전략이 딱 들어맞을 때가 있다
  - 간단한 CRUD 유스케이스에서는 웹 모델을 도메인 모델, 혹은 도메인 모델을 영속성 모델로 매핑할 필요가 없다.
- 모든 계층이 정확히 같은 구조의, 정확히 같은 정보를 필요로 한다면 매핑하지 않기 전략은 완벽한 선택지다.
- 애플리케이션 계층이나 도메인 계층에서 웹과 영속성 문제를 다루게 되면 곧바로 다른 전략을 취해야 함
  - 어떤 매핑 전략을 선택했더라도 나중에 바꿀 수 있음
- 많은 유스케이스들이 간단한 CRUD 유스케이스로 시작했다가 시간이 지남에 따라 값비싼 매핑 전략이 필요한 풍부한 행동과 유효성 검증을 가진
제대로 된 비즈니스 유스케이스로 바뀌어 간다.
  - 매핑 전략에 시간을 들이지 않을 수 있기 때문에 좋다

----------------

## '양방향' 매핑 전략

- 각 계층이 전용 모델을 가진 매핑 전략
- 웹 계층에서는 웹 모델을 인커밍 포트에서 필요한 도메인 모델로 매핑하고, 인커밍 포트에 의해 반환된 도메인 객체를 다시 웹 모델로 매핑한다.
- 영속성 계층은 아웃고잉 포트가 사용하는 도메인 모델과 영속성 모델 간의 매핑과 유사한 매핑을 담당한다.
  - 두 계층 모두 양방향으로 매핑하기 때문에 양방향 전략
- 각 계층이 전용 모델을 변경하더라도 다른 계층에는 영향이 없다
- 웹 모델은 데이터를 최적으로 표현할 수 있는 구조를 가지고, 도메인 모델은 유스케이스를 제일 잘 구현할 수 있는 구조를 가지고, 영속성 모델은 데이터베이스에
객체를 저장하기 위해 ORM에서 필요로 하는 구조를 가질 수 있다.
  - 단일 책임 원칙 만족
- 하지만 너무 많은 보일러플레이트 코드가 생긴다
  - 코드의 양을 줄이기 위해 매핑 프레임워크를 사용하더라도 두 모델 간 매핑을 구현하는 데는 시간이 든다
- 도메인 모델이 계층 경계를 넘어서 통신하는 데 사용되고 있다
  - 인커밍 포트와 아웃고잉 포트는 도메인 객체를 입력 파라미터와 반환값으로 사용
  - 도메인 모델은 도메인 모델의 필요에 의해서만 변경되는 것이 이상적이지만 바깥쪽 계층의 요구에 따른 변경에 췽갸해짐
- 어떤 매핑 전략도 철칙처럼 여겨져서는 안되고 각 유스케이스마다 적절한 전략을 택할 수 있어야 함

------------------

## '완전' 매핑 전략

- 각 연산마다 별도의 입출력 모델을 사용
  - 이런 모델을 가리켜 command 혹은 request 이와 비슷한 단어로 표현
- 웹 계층은 입력을 애플리케이션 계층의 커맨드 객체로 매핑할 책임을 가지고 있음
  - 커맨드 객체는 애플리케이션 계층의 인터페이스를 해석할 여지 없이 명확하게 만들어 줌
- 각 유스케이스는 전용 필드와 유효성 검증 로직을 가진 전용 커맨드를 가짐
- 애플리케이션 계층은 커맨드 객체를 유스케이스에 따라 도메인 모델을 변경하기 위해 매핑할 책임을 가짐
- 이 매핑 전략은 전역 패턴으로 추천하지 않음
  - 너무 많은 코드와 불필요한 복잡성 때문

-------------------

## '단방향' 매핑 전략

- 모든 계층의 모델들이 같은 인터페이스를 구현한다.
- 이 인터페이스는 관련 있는 특성(attribute)에 대한 getter 메서드를 제공해서 도메인 모델의 상태를 캡슐화한다.
- 한 계층이 다른 계층으로부터 객체를 받으면 해당 계층에서 이용할 수 있도록 다른 무언가로 매핑
- 계층 간의 모델이 비슷할 때 가장 효과적
  - 읽기 전용 연산의 경우 상태 인터페이스가 필요한 모든 정보를 제공하기 때문에 웹 계층에서 전용 모델로 매핑할 필요가 전혀 없음

----------------

## 언제 어떤 매핑 전략을 사용할 것인가?

- 그때그때 다르다
- 고정된 매핑 전략으로 계속 유지하기보다는 빠르게 코드를 짤 수 있는 간단한 전략으로 시작해서 계층 간 결합을 떼어내는 데 도움이 되는 복잡한 전략으로
갈아타는 것도 괜찮은 방법
- 팀 내에서 합의할 수 있는 가이드라인을 정해둬야 한다.

------------------

## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 각 유스케이스에 대해 좁은 포트를 사용하면 유스케이스마다 다른 매핑 전략을 사용할 수 있고, 다른 유스케이스에 영향을 미치지 않으면서
코드를 개선할 수 있기 때문에 특정 상황, 시점에 최선의 전략을 선택할 수 있다.
