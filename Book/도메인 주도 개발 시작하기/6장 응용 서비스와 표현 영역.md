# 응용 서비스와 표현 영역

------------------------

## 표현 영역과 응용 영역

- 도메인이 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요하다.
  - 응용 영역, 표현 영역
- 표현 영역
  - 사용자의 요청을 해석
  - HTTP 요청을 받아 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해서 사용자가 실행하고 싶은 기능을 판별하고
  그 기능을 제공하는 응용 서비스를 실행
  - 응용 메서드가 요구하는 파라미터와 표현 영역이 사용자로부터 전달받은 데이터는 형식이 일치하지 않기 때문에 표현 영역의 코드는
  파라미터 값을 사용해서 응용 서비스가 요구하는 객체를 생성한 뒤 응용 서비스의 메서드를 호출한다.
  - 응용 서비스를 실행한 뒤에 사용자에게 알맞은 형식으로 응답(HTML, JSON)
- 응용 영역
  - 실제 사용자가 원하는 기능을 제공하는 영역
  - 기능을 실행하는 데 필요한 입력 값을 메서드 인자로 받고 실행 결과를 리턴
  - 사용자와 상호작용은 표현 영역이 처리하기 때문에 응용 서비스는 표현 영역에 의존하지 않는다.

------------------------

## 응용 서비스의 역할

- 응용 서비스는 사용자가 요청한 기능을 실행한다.
- 요청을 처리하기 위해 리포지터리에서 도메인 객체를 가져와 사용한다.
- 응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성이 높다.
- 응용 서비스가 도메인 로직을 일부 구현하면 코드 중복, 로직 분산 등 코드 품질에 안 좋은 영향을 줄 수 있다.
- 응용 서비스는 트랜잭션 처리도 담당한다.

### 도메인 로직 넣지 않기

- 도메인 로직은 도메인 영역에 위치하고 응용 서비스는 도메인 로직을 구현하지 않는다.
- 도메인 로직을 도메인 영역과 응용 서비스에 분산해서 구현하면 코드 품질에 문제가 발생한다.
  - 코드의 응집성이 떨어진다.
  - 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아진다.
- 소프트웨어가 가져야 할 중요한 경쟁 요소 중 하나는 변경 용이성인데 일부 도메인 로직이 응용 서비스에 출현하면서 코드 변경을 어렵게 만든다.
- 소프트웨어의 가치를 높이려면 도메인 로직을 도메인 영역에 모아서 코드 중복을 줄이고 응집도를 높여야 한다.

-----------------------

## 응용 서비스의 구현

- 응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데 이는 파사드와 같은 역할을 한다.
- 응용 서비스 자체는 복잡한 로직을 수행하지 않기 때문에 응용 서비스의 구현은 어렵지 않다.

### 응용 서비스의 크기

- 응용 서비스 자체의 구현은 어렵지 않지만 응용 서비스의 크기는 생각할 거리 중 하나다.
  - 한 응용 서비스 클래스에 한 도메인의 모든 기능 구현하기
    - 장점
      - 각 기능에서 동일 로직에 대한 코드 중복을 제거할 수 있다.
    - 단점
      - 클래스의 크기가 커진다.
      - 크기가 커지면 연관성이 적은 코드가 한 클래스에 함께 위치할 가능성이 높아진다.
  - 구분되는 기능별로 응용 서비스 클래스를 따로 구현하기
    - 한 응용 서비스 클래스에서 한 개 내지 2~3개의 기능을 구현한다.
    - 장점
      - 한 클래스에 관련 기능을 모두 구현하는 것과 비교해 코드 품질을 일정 수준으로 유지하는 데 도움이 된다.
      - 각 클래스별로 필요한 의존 객체만 포함하므로 다른 기능을 구현한 코드에 영향을 받지 않는다.
    - 단점
      - 클래스의 개수가 많아진다.

### 응용 서비스의 인터페이스와 클래스

- 응용 서비스를 구현할 때 인터페이스가 필요한 지가 생각할 거리다.
- 구현 클래스가 여러 개인 경우, 혹은 런타임에 구현 객체를 교체해야 할 떄 인터페이스가 필요하다.
- 그러나 응용 서비스는 런타임에에 교체하는 경우가 거의 없고 한 응용 서비스의 구현 클래스가 두 개인 경우도 드물다.
- 인터페이스가 명확하게 필요하기 전까지는 응용 서비스에 대한 인터페이스를 작성하는 것이 좋은 선택이라고 볼 수는 없다.

### 메서드 파라미터와 값 리턴

- 스프링 MVC와 같은 웹 프레임워크는 웹 요청 파라미터를 자바 객체로 변환하는 기능을 제공하므로 응용 서비스에 데이터로 전달할
요청 파라미터가 두 개 이상 존재하면 데이터 전달을 위한 별도 클래스를 사용하는 것이 편리하다.
- 응용 서비스의 결과를 표현 영역에서 사용해야 하면 응용 서비스 메서드의 결과로 필요한 데이터를 리턴한다.

### 표현 영역에 의존하지 않기

- 응용 서비스의 파라미터 타입을 결정할 때 주의할 점은 표현 영역과 관련된 타입을 사용하면 안 된다는 점이다.
  - HttpServletRequest, HttpSession 등
- 응용 서비스에서 표현 영역에 대한 의존이 발생하면 응용 서비스만 단독으로 테스트하기가 어려워진다.
- 표현 영역의 구현이 변경되면 응용 서비스의 구현도 함께 변경해야 하는 문제도 발생한다.

### 트랜잭션 처리

- 트랜잭션을 관리하는 것은 응용 서비스의 중요한 역할이다.
- 스프링은 @Transactional이 적용된 메서드가 RuntimException을 발생시키면 트랜잭션을 롤백하고 그렇지 않으면 커밋하므로
이 규칙에 따라 코드를 작성하면 트랜잭션 처리 코드를 간결하게 유지할 수 있다.

----------------------------

## 표현 영역

- 표현 영역의 책임
  - 사용자가 시스템을 사용할 수 있는 흐름(화면)을 제공하고 제어한다.
    - 다음 화면으로 이동할 수 있는 링크나 데이터를 입력하는데 필요한 폼 등
  - 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다.
  - 사용자의 세션을 관리한다.

----------------------------

## 값 검증

- 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있다.
- 스프링과 같은 프레임워크는 값 검증을 위한 Validator 인터페이스를 별도로 제공하므로 인터페이스를 구현한 검증기를 따로 구현하면 된다.
- 표현 영역에서는 필수 값, 값의 형식, 범위 등을 검증한다.
- 응용 서비스에서는 데이터의 존재 유무와 같은 논리적 오류를 검증한다.(필수 값 검증도 하면 좋음)

--------------------------

## 권한 검사

- 표현 영역, 응용 서비스, 도메인 세 곳에서 권한 검사를 수행할 수 있다.

----------------------

## 조회 전용 기능과 응용 서비스

- 서비스에서 수행하는 추가적인 로직이 없고 단일 쿼리만 실행하는 조회 전용 기능은 굳이 서비스를 만들 필요 없이 표현 영역에서 바로
조회 전용 기능을 사용해도 문제가 없다.
- 응용 서비스를 항상 만들었던 개발자는 컨트롤러와 같은 표현 영역에서 응용 서비스 없이 조회 전용 기능에 접근하는 것이 이상하게 느껴질 수 있으나
응용 서비스가 사용자 요청 기능을 실행하는 데 별다른 기여를 하지 못한다면 서비스를 굳이 만들지 않아도 된다. 




