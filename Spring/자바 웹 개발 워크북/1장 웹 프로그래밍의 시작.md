# 웹 프로그래밍의 시작

---------------

## 자바 웹 개발 환경 만들기

### 웹 프로젝트의 기본 구조

- 대부분의 웹 프로젝트들은 브라우저, 서버, 데이터베이스와 같이 여러 프로그램이
같은 네트워크를 통해서 연결되는 구조.
- 브라우저 혹은 클라이언트 프로그램
  - 서버에서 전송한 결과를 화면에 보여주고(렌더링(rendering)) 사용자의 화면을 조작해서
  서버에 원하는 데이터를 보내고(요청 - request) 받는(응답 - response) 프로그램
  - HTML/CSS/JS ...
- 웹 서버 혹은 WAS
  - 이미지와 같은 고정된 데이터를 제공 하거나(웹 서버(정적)) 동적으로 매번 새로운 데이터를 만들어 낼 수 있는
  WAS
  - 서블릿/JSP ...

### 윈도우환경 인텔리제이에서 한글 문제

- Help -> Edit Custom VM Options
  - -Dfile.encoding=UTF-8
  - -Dconsole.encoding=UTF-8

### 프로젝트의 경로 설정

- Edit Configurations... -> Deployment 의 Application Context 설정

### 변경된 코드의 반영

- 일반 자바 프로그램과 달리 그레이들을 이용해서 컴파일 등의 작업이 처리되고 프로젝트의 build/libs 폴더 안에 내용은
톰캣을 통해서 실행하기 때문에 코드를 변경한 후에는 다시 톰캣을 재시작해야함.
- 톰캣의 재시작을 최소화하기 위해서 Edit Configurations 의 On Update action과 On frame deactivation 옵션 조정
- jsp파일의 소스코드는 변경하는 것만으로 반영되지만 자바 코드의 변경은 services 항목에서 Deploy ALL을 실행하여 다시 빌드해야함.

### 서블릿 코드 작성하기

- 톰캣에서 작성하는 자바 코드는 HttpServlet이라는 클래스를 상속해서 작성하는데 흔히 Servlet(서블릿)클래스를 생성한다고 표현한다.
- @WebServlet은 브라우저의 경로와 해당 서블릿을 연결하는 설정을 위해 사용한다.
- doGet()은 브라우저의 주소를 직접 변경해서 접근하는 경우에 호출된다.
- 서블릿에서는 PrintWriter 객체를 이용해 브라우저쪽으로 출력을 처리한다.

------------------

## 웹 기본 동작 방식 이해하기

### Request(요청) / Response(응답)

- GET 방식: 주소창에 직접 원하는 데이터를 적거나 링크를 클릭해서 호출
  - 원하는 웹의 주소를 호출할 때 필요한 데이터를 '?' 와 '&,='를 이용해서 같이 전송.
  - 주소와 필요한 데이터를 한번에 같이 보내기 때문에 단순 링크로 처리되므로 다른 사람과 공유하기 편함.
  - 주로 특정한 정보를 조회하는 용도로 사용.
- POST 방식: 입력 화면에서 필요한 내용을 작성한 후에 전송 과 같은 버튼을 클릭해서 호출
  - 주소와 데이터를 따로 보내는 방식.
  - 웹 화면을 통해서 실제 처리가 필요한 작업을 하기 위해서 사용.
- 브라우저에서 서버에 데이터를 요구하는 것을 요청(Request)라 하고 서버는 이에 응답(Response) 데이터를 보냄.
- 서버에서 브라우저로 응답을 보내는 데 서버에서는 이를 정적인 데이터인지 동적인 데이터인지에 따라 다르게 처리함.
  - 정적(static) 데이터: 항상 동일하게 고정된 데이터를 전송하는 방식으로 주로 파일로 고정된 HTML,CSS,이미지 파일 등의 데이터
  - 동적(dynamic) 데이터: 매번 필요할 때마다 다른 데이터를 동적으로 구성해서 전송하는 방식. 서버에서 데이터를 만들어 보내는 방식이라서
  서버 사이드 프로그래밍이라고 한다.
- 항상 정적 데이터를 보내는 역할만을 수행하는 서버는 웹 서버(Web Server), 동적 데이터를 만들어 보내는 경우는 웹 어플리케이션 서버(WAS)라고 구분함.

### HTTP 라는 약속

- 브라우저의 요청과 서버의 응답 사이에는 한 가지 중요한 약속을 통해 처리되는 데 이러한 데이터 교환 약속을 프로토콜(Protocol)이라 하고
웹에서는 HTTP(Hyper Text Transfer Protocol)라는 방식으로 데이터를 주고받음.

#### HTTP 메시지 확인

- 개발자 도구에서 Network 탭을 선택하면 어떤 데이터들이 오고 가는지 확인 가능

#### HTTP 메시지 구성

- HTTP 메시지는 기본적으로 헤더와 바디로 구성되어 있음.
- 브라우저에서 특정한 URL을 호출하면 요청과 응답이 하나의 쌍으로 묶여서 처리되는 데, 개발자 도구의 Network -> Header 항목에서
Request Header와 Response Header항목이 같이 보임.

#### 비연결성(Connectionless)

- 웹의 특성상 여러 명의 사용자가 브라우저를 통해 서버를 호출하는 구조이기 때문에 HTTP는 하나의 요청과 응답을 처리한 후에
연결을 종료하는 비연결성이라는 방식을 사용함.
  - 웹 페이지의 최신 결과를 다시 확인하기 위해서 새로고침을 누름.
  - 브라우저와 서버의 연결이 끝났기 때문에 다시 요청하는 것.
- 서버에서는 하나의 요청을 빨리 처리하고 연결을 종료하여 다음 요청을 받을 수 있다면 적은 리소스를 이용해서
많은 요청들을 처리할 수 있다는 장점이 있음.

### 자바 서버 사이드 프로그래밍

#### 서블릿(Servlet) 기술

- Java EE 기술 스펙중 가장 기본적인 기술이 서블릿과 JSP
- 서블릿 기술은 서버에서 동적으로 요청과 응답을 처리할 수 있는 API들을 정의한 것.
- 서블릿을 지원하는 환경에서 개발자들은 서블릿에서 제공하는 API를 이용해서 코드를 작성하고 이를 설정하는 방식으로
서블릿 프로그램을 작성하게 됨.
- JSP는 HTML을 쉽게 이용할 수 있는 방식으로 코드를 작성할 수 있기 때문에 서블릿으로는 코드를 이용한 처리, JSP로는 화면 개발을 함.
- 서블릿의 실행은 톰캣과 같이 서블릿을 실행할 수 있는 환경에서 실행이 가능한데 이를 서블릿 컨테이너라고 한다.
- 톰캣이 서블릿 컨테이너 역활을 하고 있다.
- 서블릿 코드를 실행하는 주체는 서블릿 컨테이너(톰캣..)이므로 일반 자바 프로그램과 비교했을 때 차이점이 있다.
  - 객체를 생성하거나 호출하는 주체는 사용자가 아닌 서블릿 컨테이너다.
  - 서블릿 클래스에서 생성하는 객체의 관리 자체가 서블릿 컨테이너에 의해서 관리된다.
  - 서블릿/JSP의 코드 개발은 기본적인 자바 API와 더불어 서블릿 API도 같이 사용해야 한다.
- init(), doGet(), destroy()의 호출의 주체는 개발자가 아닌 서블릿 컨테이너가 서블릿들을 관리하면서 호출한다.
- 이러한 메서드들을 서블릿의 라이프 사이클이라 한다.

#### JSP 기술

- JSP는 Java Server Pages의 약자로 서블릿 기술과 동일하게 서버에서 동적으로 데이터를 구성하는 기술이다.
- 서블릿이 있는데도 불구하고 동일한 목적으로 JSP가 제공되는 이유는 두 기술의 목적 자체가 다르기 때문이다.
- JSP 기술은 서블릿과 달리 HTML 코드를 그대로 이용하고 필요할때 약간의 자바 코드를 넣는 반면에
서블릿 코드는 자바 코드를 이용해서 HTML 문자열을 만들어내는 방식의 차이가 있다.
- JSP 코드는 자바 코드가 아님에서 서블릿과 동일하게 처리되는 데 이것은 사실 JSP 파일도 서블릿 코드로 변환되어서 컴파일되고 실행되기 때문이다.
- JSP 파일은 필요한 순간에 자바 파일로 생성되고, 이를 컴파일해서 class 파일로도 만들어진다.
- JSP는 서블릿 기술과 같은 목적이지만, 브라우저에 보내는 HTML 데이터를 만들어내는 데 더 특화된 기술이다.

#### 요약

- 서블릿/JSP 모두 Java EE 스펙의 일부
- 서블릿/JSP를 실행하기 위해서는 서블릿 컨테이너가 필요함
- 서블릿 컨테이너가 서블릿/JSP 객체를 생성하고 생명 주기를 관리함
- JSP는 내부적으로 서블릿과 같은 방식의 코드로 변환됨
- JSP는 HTML 내에 자바 코드를 추가하는 방식이고 서블릿 방식은 자바 코드 안에 HTML 코드를 추가하는 방식

### JSP를 이용해서 GET/POST 처리하기

### GET 방식은 입력과 조회

- 브라우저에서 직접 접근하는 GET 방식은 원하는 데이터 조회, 사용자가 입력할 수 있는 화면과 같은 경우에 주로 사용.
- form 태그 와 input 태그를 사용해서 데이터를 입력하고 submit하면 주소창이 달라짐

#### 쿼리 스트링(query string)과 파라미터(parameter)

- 웹 주소창 뒤에 ? 로 시작하는 내용물을 쿼리 스트링이라고 함.
- 쿼리 스트링은 키=값 형태로 데이터를 전달하는 데 여러 개의 데이터가 필요한 경우 &를 이용해서 연결.
- 키=값의 형태는 흔히 파라미터 이름과 값 이라고 함.

### POST 방식은 처리를 위한 용도

- form 태그에 action과 method 속성을 이용해서 어떤 방식으로 전송할 것인지 결정할 수 있음.
- POST 방식은 주소와 전달하고자 하는 데이터를 분리해서 전송하는 방식이므로 브라우저를 통해서 확인할 수 없고 개발자 도구를 이용해야만 확인 가능.
- POST 방식은 등록/수정/삭제와 같은 작업을 수행하기 위해서 사용.
- POST 방식은 GET방식과 달리 정보의 확산이 목적이 아니므로 굳이 하나의 문자열로 모든 정보를 표현하지 않고, URL과
정보를 따로 구분해서 전달함.(BODY)
- JSP에 '${}'로 처리된 부분이 존재하는데 이것은 EL(Expression Language)라는 기술로
서버에서 데이터를 출력하는 용도로 웹에서의 System.out.println()과 유사한 역할을 함.
- EL을 이용해 param이라는 이름의 지정된 객체를 이용해서 현재 요청에 전달된 파라미터를 쉽게 추출할 수 있음.
- form 태그에서 num1 이름으로 전송된 데이터는 ${param.num1}로 출력가능.

#### 웹의 파라미터는 모두 문자열

- JSP가 브라우저에 전달하고 싶은 데이터를 구성하는 데는 상당히 편리하지만 복잡한 코드를 넣는 데는 적합하지 않음.
- 모든 데이터가 문자열로 처리되기 때문에 결과 데이터를 처리하기 위해서는 Integer.parseInt와 같은 형변환 코드가 필요함.

### JSP의 올바른 사용법

- JSP는 기본적으로 GET/POST 방식의 호출을 구분하지 않기 때문에 POST 방식으로 접근해야 하는 JSP에
GET방식으로도 얼마든지 호출할 수 있다는 문제가 있음.
- 이 경우 형변환이라든지 내부의 코드가 오류가 남.
- 따라서 JSP는 다음과 같이 제한적인 용도로 사용함.
  - JSP에서 쿼리 스트링이나 파라미터를 처리하지 않는다.(서블릿을 통해서 처리)
  - JSP는 입력 화면을 구성하거나 처리 결과를 보여주는 용도로만 사용한다.
  - 브라우저는 직접 JSP 경로를 호출하지 않고 서블릿 경로를 통해서 JSP를 보는 방식으로 사용한다.
- 이런 문제를 해결하기 위해서 등장한 방식이 웹 MVC 방식으로 JSP는 결과만 출력하고 처리는 서블릿을 이용하는 방식으로
변화함.

---------------------

## Web MVC 방식

- JSP를 이용한 개발 방식의 경우 유지 보수나 URL 변경 등은 유연하지 못하다는 단점이 부각되면서
2000년대 중반 이후의 개발은 거의 MVC 형식으로 서블릿과 JSP를 같이 이용하는 형태로 개발됨.

### MVC 구조와 서블릿/JSP

- 서블릿 코드의 경우 자바 코드를 그대로 이용할 수 있고, 상속이나 인터페이스의 처리도 가능. 하지만 HTTP로 전달된 메시지를 구성하는
HTML을 처리하는 데 상당히 많은 코드를 작성해야 함.
- JSP의 경우 HTML 코드를 바로 사용할 수 있으므로 HTTP 메시지 작성에는 적합하지만, 그 안에 자바 코드를 재사용하는 문제나
자바 코드와 HTML이 혼재하는 것과 같은 여러 문제가 존재.
- 따라서 브라우저의 요청은 해당 주소를 처리하는 서블릿에 전달되고, 서블릿 내부에서는 응답에 필요한 재료 데이터들을 준비함. 서블릿은 준비한 데이터들을
JSP로 전달하고 JSP에서는 EL을 이용해서 최종적인 결과 데이터를 생성하는 구조로 변경됨.
- 웹 MVC라는 구조는 'Model - View - Controller'의 역할을 분리해서 처리하는 구조로
데이터는 컨트롤러에서 결과는 뷰에서 처리함. 서블릿이 컨트롤러, JSP가 뷰
- 컨트롤러 역할을 하는 서블릿은 JSP에 필요한 데이터를 가공하는 역할을 하는데 이 때 필요한 데이터를 제공하는 객체를 모델이라 함.

### MVC 구조

#### GET

- Controller는 @WebServlet으로 urlPatterns 속성을 지정해서 처리해야 하는 경로를 지정함.
- 부모 클래스인 HttpServlet의 doGet()을 재정의하고 GET 방식으로 들어오는 요청에 대해서만 처리하도록 구성.
- RequestDispatcher는 서블릿에 전달된 요청을 다른 쪽으로 전달 혹은 배포하는 역할이다.

#### POST

- doPost() 재정의
- POST 방식에선 HttpServeltRequest.getParameter(parameterName)으로 파라미터를 받을 수 있다.
- 처리한 결과를 보여주는 HttpServletResponse.sendRedirect(url)

### PRG 패턴(Post-Redirect-Get)

- 웹 MVC 구조에서 가장 흔하게 사용하는 패턴.
1. 사용자는 컨트롤러에 원하는 작업을 POST 방식으로 처리하기를 요청.
2. POST 방식을 컨트롤러에서 처리하고 브라우저는 다른 경로로 이동(GET)하라는 응답(Redirect)
3. 브라우저는 GET 방식으로 이동

------------------------

## HttpServlet

- HttpServlet은 GET/POST 등에 맞게 메서드를 제공하므로, 개발자들은 본인에게 필요한 메서드를 오버라이드하는 것만으로
처리를 나누어서 할 수 있음.
- HttpServlet을 상속받은 클래스 객체는 톰캣과 같은 WAS의 내부에서 자동으로 객체를 생성하고 관리하기 때문에 개발자가 객체
관리에 신경 쓸 필요가 없음.
- HttpServlet은 멀티 스레드에 의해서 동시에 실행될 수 있도록 처리되기 때문에 개발자는 동시에 많은 사용자를
어떻게 처리해야 하는지에 대한 고민을 줄일 수 있음.

### HttpServlet의 라이프 사이클

1. 브라우저가 톰캣에 서블릿이 처리해야 하는 특정한 경로를 호출.
2. 톰캣은 해당 경로에 맞는 서블릿 클래스를 로딩하고 객체를 생성함. 이 과정에서 init()라는 이름의 메서드를 실행해서
서블릿 객체가 동작하기 전에 수행해야 하는 일들을 처리할 수 있음.
3. 생성된 서블릿 객체는 브라우저의 요청에 대한 정보를 분석해서 GET/POST 등의 정보와 함께 같이 전달되는
파라미터들을 HttpServletRequest라는 타입의 파라미터로 전달받음. 응답을 처리하는 데 필요한 기능들은
HttpServletResponse타입의 객체로 전달받음.
4. 서블릿 내부에서 doGet()/doPost() 등의 메서드를 실행함.이 후 동일한 주소의 호출이 있을 때 서블릿은 동일한 객체 하나만을 이용해서
처리함.
5. 톰캣이 종료될 때 서블릿의 destroy() 메서드를 실행함.

### HttpServletRequest의 주요 기능

- 서블릿 객체에서 최종적으로 요청을 처리하는 메서드들은 HttpServletRequest와 HttpServletResponse를 파라미터로 전달 받음.
- HttpServletRequest는 HTTP 메시지 형태로 들어오는 요청에 대한 정보를 파악하기 위해 제공됨.

#### getParameter()

- "?name=AAA&age=20"과 같은 쿼리 스트링에서 name 이나 age라는 키를 이용해 값을 얻는 역할을 위해 사용.
- getParameter()의 결과는 항상 String.
- 해당 파라미터가 없으면 null(null 체크 주의)
- 문자열로 반환되기에 숫자를 처리할 때 예외 주의

#### getParameterValues()

- 동일한 이름의 파라미터가 여러 개 있는 경우 사용.
- name이라는 이름의 파라미터가 여러 개 존재한다면 getParameterValues()를 이용해 String[] 타입으로 반환됨.

#### setAttribute()

- JSP로 전달할 데이터를 추가할 때 사용.
- setAttribute()는 키와 값의 형태로 데이터를 저장할 수 있음.
- JSP에서는 서블릿에서 setAttribute()로 전달된 데이터를 화면에 출력

#### RequestDispatcher

- 웹 MVC 구조에서는 HttpServletRequest의 getRequestDispatcher()를 이용해서 ReqeustDispatcher 타입의 객체를 구할 수 있음.
- 현재의 요청을 다른 서버의 자원(서블릿 or JSP)에게 전달하는 용도로 사용.
  - forward(): 현재까지의 모든 응답내용은 무시하고 JSP가 작성하는 내용만을 브라우저로 전달.
  - inclue(): 지금까지 만들어진 응답 내용 + JSP가 만든 내용 전달
- 거의 forward만 씀

### HttpServletResponse의 주요 기능

#### sendRedirect()

- 브라우저에게 다른 곳으로 가라 응답 메시지를 전달함.
- HTTP에서 Location 이름의 HTTP 헤더로 전달되는데 브라우저는 Location이 있는 응답을 받으면 화면을 처리하는 대신에
주소창에 지정된 주소로 이동하고 다시 호출함.
- 브라우저의 주소가 아예 변경되기 때문에 사용자의 새로고침과 같은 요청을 미리 방지할 수 있고, 특정한 작업이 완전히 끝나고
새로 시작하는 흐름을 만들 수 있음.

---------------

## 모델(Model)

### 모델과 3티어

- 웹 MVC입장에서 모델은 컨트롤러에 필요한 기능이나 데이터를 처리해주는 존재지만 시스템 전체 구조로 보면
모델은 컨트롤러와 뷰를 제외한 남은 부분.
- 모델을 담당하는 영역을 다시 세분화시켜서 데이터베이스를 담당하는 영역과 비즈니스 로직을 처리하는 영역으로 구분하여
서비스(로직 처리) 계층과 영속(데이터 처리) 계층으로 분리하기도 함.
- 따라서 View 계층에 JSP와 서블릿, 서비스 계층, 영속 계층 3티어 구조가 됨.

### DTO(Data Transfer Object)

- 3 티어와 같이 계층을 분리하는 경우에는 반드시 계층이나 객체들 간에 데이터 교환이 이루어지게 됨.
- 대부분은 한 개 이상의 데이터를 전달할 때가 많기 때문에 여러 개의 데이터를 묶어서 하나의 객체로 전달하는 것을 DTO라고 함.
- DTO는 여러 개의 데이터를 묶어서 필요한 곳에 전달하거나 호출을 결과로 받는 방식으로 사용하기 때문에 특별한 규격이나 제약이 있는 것은
아니지만 대부분 Java Beans 형태로 구성하는 경우가 많음.
- Java Beans 형태
  - 생성자가 없거나 반드시 파라미터가 없는 생성자 함수(기본 생성자)를 가지는 형태
  - 속성(멤버 변수)은 private으로 작성
  - getter/setter 제공
- 컨트롤러는 DTO를 구성해서 서비스 계층을 호출하기도 하고, 반대로 서비스 계층에서 DTO를 받기도 하기 때문에
서비스 계층 구성 전에 DTO를 위한 클래스를 구성함.

### 서비스 객체

- 서비스 객체는 간단히 말하면 로직들의 묶음이라 할 수 있음.
- CRUD같은 기능들은 모두 서비스 객체에 모아서 구현됨.

### 컨트롤러에서 모델 처리하기

- 웹 MVC 구조에서는 화면에 필요한 데이터를 처리하고자 컨트롤러는 서비스 객체의 힘을 빌려 처리함.
- HttpServletRequest의 setAttribute()를 통해 데이터를 보관하고 보관된 데이터는 JSP에서 꺼내서 사용하게 됨.
- JSP 에서는 EL을 사용해 Attribute name을 출력.

### JSP - EL(Expression Language)

- ${}는 EL의 표현식.
- 최근에는 JSP에 자바 코드를 사용해서 결과를 출력하는 일은 거의 없음.
- JSP는 주로 HTML 태그들과 자바스크립트, CSS 등을 이용해 코드를 작성함.
- EL을 이용하면 자바 코드를 몰라도 getter/setter를 호출할 수 있고, 약간의 연산도 가능함.

### EL을 이용한 출력

- EL을 이용하는 경우에는 자동으로 getter를 호출하게 됨.
- getTno(), getTitle() 대신에 ${list[0].tno}, ${list[0].title}로 작성할 수 있음.
- EL이 출력문만을 담당하기 때문에 제어문이나 반복문과 같이 식(expression)이 아닌 문(statement)를 처리하기 위해서는 JSTL 라이브러리가 필요함.

### JSTL

- JSTL(JavaServer Pages Standard Tag Library)은 JSP에서 동작하는 새로운 태그들의 묶음임.
- JSTL은 자바 문법보다 조금 더 간결하게 제어문이나 반복문, 선언문 등을 처리할 수 있고 확장이 가능하도록 설계됨.
- 라이브러리가 존재해야 하므로 의존성 라이브러리를 추가해야 함.
  - implementation group: 'jstl', name: 'jstl', version: '1.2'

### JSP 파일에서 JSTL 사용하기

- 파일 상단에 관련 태그를 설정해야 함.
```java
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
```
- JSP 에서 `<%@ %>`로 작성되는 코드를 지시자(directives)라고 한다.

#### &lt;c:forEach>

- 배열이나 리스트 처리에 사용되는 반복문.
- 속성
  - var: EL에서 사용될 변수 이름
  - items: List,Set,Map,Enumeration,Iterator 등의 컬렉션
  - begin/end: 반복의 시작/끝 값

#### &lt;c:if> , &lt;c:choose>

- c:if 경우 test라는 속성이 존재하는데 test 속성값으로는 true/false로 나올 수 있는 식이나 변수 등이 들어감.
- c:choose의 경우 switch 구문과 비슷한 역할을 함.
  - c:when test=... 나 c:otherwise를 이용해서 if ~ else if ~ else 처리가 가능함.

#### &lt;c:set>

- EL이나 JSTL을 이용해서 반복문이나 제어문을 처리하다 보면 새로운 변수를 생성해야 하는 경우가 있음.
- 그럴 때 c:set을 이용하여 변수를 생성하고 사용할 수 있음.
- var 속성으로 변수명을 지정할 수 있고, value 속성으로 값을 지정할 수 있음.
