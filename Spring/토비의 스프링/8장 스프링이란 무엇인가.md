# 스프링이란 무엇인가?

--------------------

## 스프링의 정의

- 자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크

#### 애플리케이션 프레임워크

- 라이브러리나 프레임워크는 특정 업무 분야나 한 가지 기술에 특화된 목표를 가지고 만들어짐
  - 웹 계층을 MVC 구조로 손쉽게 만들 수 있음
  - 포맷과 출력장치를 유연하게 변경할 수 있는 애플리케이션 로그 기능을 제공
  - 간단한 설정만으로 관계형 DB와 자바 오브젝트를 매핑해주는 ORM 기술
- 프레임워크는 애플리케이션의 특정 계층에서 주로 동작하는 한 가지 기술 분야에 집중되지만 스프링은 애플리케이션 프레임워크 라는 특징을 가지고 있음
  - 애플리케이션 프레임워크란 특정 계층이나 기술, 업무 분야에 국한되지 않고 애플리케이션의 전 영역을 포괄하는 범용적인 프레임워크
- 스프링이 자바 엔터프라이즈 개발의 전 영역을 포괄하는 애플리케이션 프레임워크가 된 데는 스프링의 탄생 배경과 밀접한 관련이 있음
  - 스프링의 기원은 J2EE 기술서적에 딸린 예제 코드
- 스프링을 MVC 프레임워크 또는 JDBC/ORM 지원 프레임워크라고 생각하는 것은 스프링이 다루는 일부 영역만 봤기 때문이고 스프링을 IoC/DI 프레임워크나 AOP 툴이라고
보는 이유는 스프링이 제공하는 핵심 기술에만 주목했기 때문
- 스프링의 일차적인 존재 목적은 애플리케이션을 편리하게 개발하게 해주는 애플리케이션 프레임워크로 사용되는 것

#### 경량급

- 스프링 자체가 아주 가볍다거나 작은 규모의 코드로 이뤄졌다는 뜻이 아님
  - 스프링은 20여개의 모듈로 세분화되고 수십만 라인에 달하는 매우 복잡하고 방대한 규모의 프레임워크
- 가볍다는 이유는 불필요하게 무겁지 않다는 의미
  - 스프링이 탄생되기 전 자바 엔터프라이즈 기술의 불필요한 복잡함에 반대되는 개념
  - EJB

#### 자바 엔터프라이즈 개발을 편하게

- 스프링은 다른 프레임워크가 말하는 '개발을 편하게' 보다 근본적인 부분에서 엔터프라이즈 개발의 복잡함을 제거해내고 진정으로 개발을 편하게 해주는 해결책을 제시
  - 단순히 편리한 몇 가지 도구나 기능을 제공해주는 차원이 아님
  - 근본적인 문제점에 도전해서 해결책을 제시함
- 편리한 애플리케이션 개발이란 개발자가 복잡하고 실수하기 쉬운 로우레벨 기술에 많은 신경을 쓰지 않으면서도 애플리케이션의 핵심인 사용자의 요구사항(비즈니스 로직)을
빠르고 효과적으로 구현하는 것

------------

## 스프링의 목적

### 엔터프라이즈 개발의 복잡함

#### 기술적인 제약조건과 요구사항이 늘어가기 때문

- 엔터프라이즈 시스템이란 서버에서 동작하며 기업과 조직의 업무를 처리해주는 시스템
- 많은 사용자의 요청을 동시에 처리해야 하기 때문에 서버의 자원을 효율적으로 공유하고 분배해서 사용할 수 있어야 함
- 기업의 핵심 정보를 처리하거나 미션 크리티컬한 금융, 원자력, 항공, 국방 등의 시스템을 다루기도 하기 때문에 보안과 안정성, 확장성 면에서도 뛰어나야 함
- 즉 엔터프라이즈 시스템을 개발하는 데는 순수한 비즈니스 로직을 구현하는 것 외에도 기술적으로 고려할 사항이 많음

#### 엔터프라이즈 애플리케이션이 구현해야 할 핵심기능인 비즈니스 로직의 복잡함이 증가하기 때문

- 다양하고 복잡한 업무 처리 기능을 엔터프라이즈 시스템이 구현해야 함
- 복잡하다는 건 단지 양이 많고 어렵다는 뜻이 아닌 세부 요소가 이해하기 힘든 방식으로 얽혀 있고 쉽게 다루기 어렵다는 의미

### 복잡함을 해결하려는 도전

#### 제거될 수 없는 근본적인 복잡함

- 엔터프라이즈 개발의 근본적인 복잡함의 원인은 제거할 대상이 아님
  - 현실적으로 불가능하기 때문

#### 실패한 해결책: EJB

- EJB는 선언적 트랜잭션이나 선언적 보안, 컨테이너를 통한 리모팅 기술의 적용 컴포넌트 생명주기 관리 등은 어느 정도 충족시켰으나
EJB 환경에서 동작하기 위해 특정 인터페이스를 구현하고, 특정 클래스를 상속하고, 서버에 종속적인 서비스를 통해서만 접근하고 사용이 가능하게 만드는 등의
EJB 개발 방식은 잘못된 선택이었음
- 일부 기술적인 복잡함을 덜어주려는 시도를 하다가 오히려 더 큰 복잡함을 추가하는 실수
- EJB라는 틀 안에서 자바 코드를 만들게 강제함으로써 자바 언어가 원래 갖고 있던 장점마저 잃어버림

#### 비침투적인 방식을 통한 효과적인 해결책: 스프링

- 기술의 적용 사실이 코드에 직접 반영되지 않는 다는 특징인 비침투적 기술
- 스프링을 이용하면 기술적인 복잡함과 비즈니스 로직을 다루는 코드를 깔끔하게 분리할 수 있음
  - 스프링 스스로가 애플리케이션 코드에 불필요하게 나타나지 않음

### 복잡함을 상대하는 스프링의 전략

- 기본적인 전략은 비즈니스 로직을 담은 애플리케이션 코드와 엔터프라이즈 기술을 처리하는 코드를 분리시키는 것

#### 기술적 복잡함을 상대하는 전략

- 기술적인 복잡함은 일단 추상활르 통해 로우레벨의 기술 구현 부분과 기술을 사용하는 인터페이스를 분리하고, 환경과 세부 기술에
독립적인 접근 인터페이스를 제공하는 것이 가장 좋은 해결책
- 기술과 비즈니스 로직의 혼재로 발생하는 복잡함을 해결하기 위한 스프링의 접근 방법은 AOP
  - 애플리케이션 로직을 담당하는 코등 ㅔ남아 있는 기술 관련 코드를 깔끔하게 분리해서 별도의 모듈로 관리하게 해주는 강력한 기술

------------

## POJO 프로그래밍

### 스프링의 핵심: POJO

- 스프링 애플리케이션은 POJO를 이용해서 만든 애플리케이션 코드와, POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계정보로 구분됨
- 스프링의 주요 기술인 IoC/DI, AOP와 PSA는 애플리케이션을 POJO로 개발할 수 있게 해주는 가능기술이라 불림

### POJO란 무엇인가?

- Plain Old Java Object
- 간단한 자바오브젝트
- 이름이 생긴 이유는 평범한 자바오브젝트에는 EJB와 같은 이름이 없어 꺼려지기 때문

### POJO의 조건

#### 특정 규약(contract)에 종속되지 않는다

- POJO는 자바 언어와 꼭 필요한 API 외에는 종속되지 않아야 한다
  - EJB2와 같이 특정 규약을 따라 비즈니스 컴포넌트를 만들어야 하는 경우는 POJO가 아님
  - 스트러츠 1 과 같이 특정 클래스를 상속해서 만들어야 하는 규약이 있는 경우도 마찬가지
- 특정 규약을 따라 만들게 하는 경우는 대부분 상속을 요구하는데 그럴 경우 자바의 단일 상속 제한 때문에 더 이상 해당 클래스에 객체지향적인'
설계 기법을 적용하기가 어려워지는 문제가 생김
- 규약이 적용된 환경에 종속적이 되기 때문에 다른 환경으로 이전이 힘들다는 문제점도 있음
- 객체지향 설계의 자유로운 적용이 가능한 오브젝트여야만 POJO 라고 불릴 수 있음

#### 특정 환경에 종속되지 않는다

- EJB 3는 이전 버전의 문제점이던 규약에 따라 오브젝트를 만들어야 한다는 단점은 극복했지만 JNDI라는 서버 서비스를 필요로 함
  - JNDI가 없는 환경에서는 그대로 사용하기가 힘듬
  - POJO라고 할 수 없음
- POJO는 환경에 독립적이어야 함
- 비즈니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 사용해서는 안 됨
  - 웹이라는 환경으로 제한해버리기 떄문
  - 비즈니스 로직을 담은 코드에 HttpServletRequest나 HttpSession, 캐시와 관련된 API가 등장하거나 웹 프레임워크의 클래스를 직접
  이용하는 부분이 있다면 그것은 진정한 POJO라고 볼 수 없음

### POJO의 장점

- POJO가 될 수 있는 조건이 그대로 POJO의 장점
- 특정한 기술과 환경에 종속되지 않는 오브젝트는 그만큼 깔끔한 코드가 될 수 있음
- 자동화된 테스트에 매우 유리
  - 환경의 제약이 없기 때문
  - 컨테이너에서만 동작을 확인할 수 있는 EJB2는 테스트하려면 서버의 구동 및 빌드와 배치 과정까지 필요
- 객체지향적인 설계를 자유롭게 적용할 수 있다는 것도 큰 장점

### POJO 프레임워크

- POJO 프로그래밍이 가능하도록 기술적인 기반을 제공하는 프레임워크
  - 스프링과 하이버네이트가 대표적
- 스프링은 비즈니스 로직의 복잡함과 엔터프라이즈 기술의 복잡함을 분리해서 구성할 수 있게 도와줌
  - 자신은 기술영역에만 관여하지 비즈니스 로직을 담당하는 POJO에서는 모습을 감춤
  - 데이터 엑세스 로직이나 웹 UI 로직을 다룰 때만 최소한의 방법으로 관여함

------------

## 스프링의 기술

- 스프링의 기술(IoC/DI, AOP, PSA)는 진정한 목표인 POJO 기반의 엔터프라이즈 개발을 편리하게 해주는 도구일 뿐
- 스프링 사용자라면 스프링이 직접 제공하지 않는 기술에 대해서도 PSA나 다른 기술을 적용할 줄 알아야 함

### 제어의 역전 (IoC) / 의존관계 주입(DI)

- 가장 기본이 되는 기술
- AOP와 PSA도 IoC/DI에 바탕을 두고 있음
- 왜 두 개의 오브젝트를 분리해서 만들고, 인터페이스를 두고 느슨하게 연결한 뒤, 실제 사용할 대상은 DI를 통해 외부에서 지정하는 것일까?
- 직접 자신이 사용할 오브젝트를 new 키워드로 생성해서 사용하는 강한 결합을 쓰는 방법보다 나은 점은 무엇일까?
- 유연한 확장이 가능하기 위해서
- OCP라는 객체지향 설계 원칙
- A->B 라는 의존관계를 갖는 오브젝트 구조
  - 확장은 B가 자유롭게 변경될 수 있음을 의미
  - B가 변경돼도 A는 아무런 영향을 받지 않고 그대로 유지 가능하다는 뜻
  - B 관점에서는 유연한 확장이고 A 관점으로 보면 변경 없이 재사용이 가능함
  - B가 B1, B2, B3로 구현 방법이 바뀌어도 됨

#### DI의 활용 방법


- 핵심기능의 변경
  - 가장 대표적인 적용 방법으로 의존 대상의 구현을 바꾸는 것
  - A->B 구조에서 B의 구현 방식을 필요에 따라 통째로 B1, B2, B3로 바꾸는 것
  - 서비스 오브젝트가 사용하는 DAO가 있다고 할때 DAO의 구현을 JDBC, JPA, MyBatis 등으로 변경하는 것
  - 실제 의존하는 대상이 가진 핵심기능을 DI 설정을 통해 변경하는 것
- 핵심기능의 동적인 변경
  - 의존 오브젝트의 핵심기능 자체를 바꾸는 것이지만 동적으로 매번 다르게 변경하는 것
  - DI도 기본적으로 런타임 시에 동적으로 의존 오브젝트를 연결해주는 것이긴 하지만 DI 되고 나면 그 후에 바뀌지는 않음
  - DI를 잘 활용하면 애플리케이션이 동작하는 중간에 그 의존 대상을 다이내믹하게 변경할 수 있음
  - 사용자의 등급에 따라서 다른 DataSource를 사용하게 만들 수도 있음
  - DAO -> DataSource의 관계에서 현재 접속한 사용자의 등급에 따라 다른 DataSource를 DAO가 사용하게 할 수도 있음
  - 기술적으로 보자면 다이내믹 라우팅 프록시나 프록시 오브젝트 기법을 활용한것
- 부가기능의 추가
  - 핵심기능은 그대로 둔 채로 부가기능을 추가하는 것
  - 데코레이터 패턴
  - 인터페이스를 두고 사용하게 하고 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용할 수 있음
- 인터페이스의 변경
  - 사용하려고 하는 오브젝트가 가진 인터페이스가 클라이언트와 호환되지 않을 경우 DI가 유용
  - 어댑터 패턴
- 프록시
  - 필요한 시점에서 실제 사용할 오브젝트를 초기화하고 리소스를 준비하게 해주는 지연된 로딩
  - 원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시
  - 둘 다 DI를 필요로 함
- 템플릿과 콜백
  - 템플릿/콜백 패턴은 DI의 특별한 적용방법
  - 반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면
  지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있음
- 싱글톤과 오브젝트 스코프
  - DI할 오브젝트의 생명주기를 제어할 수 있음
  - 가장 기본이 되는 스코프는 싱글톤
  - HTTP 요청당 하나의 오브젝트가 만들어지거나, HTTP 세션당 하나씩 오브젝트가 만들어지게 할 수 있는데 이것은 개발자가 지정 가능함
- 테스트
  - 다른 오브젝트와의 사이에서 일어나는 일을 테스트를 위해 조작할 수 있게 함
  - 스텁 또는 목 오브젝트 같은 테스트 대역을 사용할 때 DI는 중요한 역할을 함

### 관점 지향 프로그래밍 (AOP)

- AOP와 OOP는 서로 배타적이 아님
  - 새로운 프로그래밍 패러다임
- AOP는 복잡해져 가는 애플리케이션의 요구조건과 기술적인 난해함을 모두 해결하는 객체지향 기기술의 한계와 단점을 극복하도록 도와주는 보조적인
프로그래밍 기술

#### AOP의 적용 기법

- 스프링과 같이 다이내믹 프록시를 사용하는 방법
  - 기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용
- 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법
  - 프록시 방식의 AOP로는 할 수 없는 작업을 위해 AspectJ를 사용

#### AOP의 적용 단계

1. 미리 준비된 AOP 이용
   - 스프링이 미리 만들어서 제공하는 AOP 기능
   - 트랜잭션
   - @Configurable 애노테이션을 이용해서 도메인 오브젝트에 DI를 자동적용해주는 AOP 기능
     - AspectJ를 이용한 AOP가 반드시 필요
2. 전담팀을 통핸 정책 AOP 적용
   - 애플리케이션 전체적으로 이용 가능한 것을 소수의 AOP 담당자 관리하에 적용해볼 수 있음
   - 비즈니스 로직을 가진 오브젝트에 대한 보안, 특정 계층의 오브젝트 이용 전후의 작업 기록을 남기는 로깅, 데이터 추적을 위한 트레이싱, 성능 모니터링 등
   - 개발자가 직접 자신이 만드는 코드에 추가하려면 개발 표준이나 가이드라인이 미리 완벽하게 준비되어 있어 이에 따라 개발하게 해야 함
3. AOP의 자유로운 이용
   - 개발자 스스로가 AOP를 활용할 수 있는 단계

### 이식 가능한 서비스 추상화 (PSA)

- 환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해주는 PSA