# OAuth 2: 리소스 서버 구현

- 리소스 서버 구현을 논의할 때 중요한 것은 리소스 서버가 토큰을 검증하는 방법을 선택하는 것이다.
- 리소스 서버 수준에서 토큰 검증을 구현하는 데는 여러 옵션이 있다.
  - 리소스 서버가 직접 권한 부여 서버를 호출해서 발행한 토큰이 맞는지 확인하는 것
  - 권한 부여 서버가 토큰을 저장할 때 공유된 데이터베이스를 사용하는 것
    - 데이터베이스 참조 방식(blackboarding)이라고도 한다.
  - 암호화 서명을 이용하는 것
    - 일반적으로 JSON 웹 토큰을 이용한다.

-------------------

## 리소스 서버 구현

- 권한 부여 서버가 토큰을 발행하는 이유는 클라이언트가 사용자의 리소스에 접근하는 것을 허락하기 위한 것이다.
- 리소스 서버는 사용자의 리소스를 관리하고 보호하므로 우리가 리소스 서버를 구현할 수 있어야 한다.

------------

## 원격으로 토큰 확인

- 직접 권한 부여 서버를 호출하는 토큰 검증 구현
1. 권한 부여 서버가 엔드포인트 하나를 노출한다. 엔드포인트는 올바른 토큰을 제시하면 부여된 권한이 반환된다.
2. 리소스 서버는 각 요청을 수행할 때 엔드포인트를 호출한다. 이 방식으로 클라이언트에서 토큰을 검증하고 클라이언트에 부여된 권한도 얻는다.
- 간단하고 어떤 종류의 토큰 구현에도 적용할 수 있다는 장점이 있다.
- 확인되지 않은 새 토큰이 포함된 요청을 받을 때마다 권한 부여 서버를 호출해야 하기에 불필요한 부하가 생길 수 있고, 네트워크가 항상 100% 안정적인 것은
아니라는 점도 있다.

------------

## JdbcTokenStore로 데이터베이스 참조 구현

- 권한 부여 서버와 리소스 서버가 공유 데이터베이스를 이용하는 애플리케이션을 구현한다.
  - 데이터베이스 참조라고 부른다.
- 토큰을 발행하고 검증하면 리소스 서버와 권한 부여 서버가 직접 통신할 필요가 없다는 장점이 있으나 공유 데이터베이스를 추가해야 하고
병목 현상이 생길 수 있다.

-------------
