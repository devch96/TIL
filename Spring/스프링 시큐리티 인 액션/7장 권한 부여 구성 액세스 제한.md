# 권한 부여 구성: 액세스 제한

- 대부분의 애플리케이션에서는 시스템에서 식별된 모든 사용자가 시스템의 모든 리소스에 액세스할 수 있는 것은 아니다.
- 권한 부여(Authorization)는 식별된 클라이언트가 요청된 리소스에 액세스할 권한이 있는지 시스템이 결정하는 프로세스다.
- 스프링 시큐리티에서 애플리케이션은 인증 흐름을 완료한 후 요청을 권한 부여 필터에 위임한다.
- 필터는 구성된 권한 부여 규칙에 따라 요청을 허용하거나 거부한다.


1. 클라이언트가 요청한다.
2. 인증이 완료되면 사용자 세부 정보가 보안 컨텍스트에 저장된다. 요청이 권한 부여 필터로 위임된다.
3. 권한 부여 필터가 요청을 허용할지 결정한다.
4. 권한이 부여되면 요청이 컨트롤러로 전달된다.

-----------

## 권한과 역할에 따라 접근 제한

- GrantedAuthority 인터페이스는 주로 권한 부여 프로세스와 연관된다.

```java
public interface GrantedAuthority extends Serializable {
    String getAuthority();
}

public interface UserDetails extends Serializable {
    Collection<? extends GrantedAuthority> getAuthorities();
}
```

### 사용자 권한을 기준으로 모든 엔드포인트에 접근 제한

- 다음과 같은 세 메서드를 이요한 세가지 방법으로 접근을 구성할 수 있다.
  - hasAuthority()
    - 애플리케이션이 제한을 구성하는 하나의 권한만 매개 변수로 받는다. 해당 권한이 있는 사용자만 엔드포인트를 호출할 수 있다.
  - hasAnyAuthority()
    - 애플리케이션이 제한을 구성하는 권한을 하나 이상 받을 수 있다. 주어진 권한 중 하나라도 있을 때라고 기억하면 편한다.
  - access()
    - SpEL(Spring Expression Language)를 기반으로 권한 부여 규칙을 구축한다.

    
### 사용자 역할을 기준으로 모든 엔드포인트에 대한 접근을 제한

- 스프링 시큐리티는 권한을 제한이 적용되는 결이 고운 이용 권리라고 이해한다.
- 역할은 사용자가 착용하는 배지와 비슷하며 사용자에게 작업 그룹에 속한 이용 권리를 제공한다.
- 내부적으로 역할도 스프링 시큐리티에서 같은 GrantedAuthority 계약으로 나타낸다.
- 역할을 정의할 때 역할 이름은 ROLE_ 접두사로 시작해야 한다.
  - 구현 수준에서 이 접두사는 역할과 권한 간의 차이를 나타낸다.
- 사용자 역할에 대한 제약 조건을 설정하기 위해 다음 메서드 중 하나를 이용할 수 있다.
  - hasRole()
    - 애플리케이션이 요청을 승인할 하나의 역할 이름을 매개 변수로 받는다.
  - hasAnyRole()
    - 애플리케이션이 요청을 승인할 여러 역할 이름을 매개 변수로 받는다.
  - access()
    - 애플리케이션이 요청을 승인할 역할을 스프링 식으로 지정한다.

### 모든 엔드포인트에 대한 접근 제한

- permitAll()
  - 모든 사용자 접근 허용
- denyAll()
  - 모든 사용자 접근 제한

------------

## 요약

- 권한 부여는 애플리케이션이 인증된 요청을 허가할지 결정하는 프로세스다. 권한 부여는 항상 인증 이후에 수행된다.
- 애플리케이션이 인증된 사용자의 권한과 역할에 따라 권한을 부여하는 방법을 구성할 수 있다.
- 애플리케이션에서 인증되지 않은 사용자가 특정 요청을 수행할 수 있게 지정할 수도 있다.
- denyAll() 메서드로 앱이 모든 요청을 거부하고 permitAll() 메서드로 모든 요청을 수락하게 할 수 있다.