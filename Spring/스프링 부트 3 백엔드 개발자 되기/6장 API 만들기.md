# API 만들기

-----------

## API와 REST API

- API는 클라이언트의 요청을 서버에 잘 전달하고, 서버의 결과물을 클라이언트에게 잘 돌려주는 역할

### REST API

- 웹의 장점을 최대한 활용하는 API
- REpresentational State Transer을 줄인 표현
  - 자원을 이름으로 구분해 자원의 상태를 주고받는 API 방식
- 특정 기술이 아닌 URL의 설계 방식
- REST API의 특징
  - 서버/클라이언트 구조
    - 자원이 있는 쪽이 Server, 자원을 요청하는 쪽이 Client
    - 서로 간 의존성이 줄어듬
  - 무상태
    - HTTP 프로토콜은 Stateless Protocol이므로 REST 역시 무상태성을 갖음
    - Client의 context를 Server에 저장하지 않음
      - 세션, 쿠키와 같은 context 정보를 신경 쓰지 않음
    - Server는 각각의 요청을 완전히 별개의 것으로 인식하고 처리함
  - 캐시 처리 가능
    - 웹 표준 HTTP 프로토콜을 그대로 사용하므로 웹에서 사용하는 기존의 인프라를 그대로 활용할 수 있음
  - 계층화
    - Client는 REST API Server만 호출함
    - REST Server는 다중 계층으로 구성될 수 있음
      - API Server는 순수 비즈니스 로직을 수행하고, 보안, 로드밸런싱, 암호화, 인증 등을 추가하여 구조상 유연성을 줄 수 있음
  - 인터페이스 일관성
    - URI로 지정한 자원에 대한 조작을 통일되고 한정적인 인터페이스로 수행함
    - HTTP 표준 프로토콜에 따르는 모든 플랫폼에서 사용이 가능함
- REST API의 장점과 단점
  - 장점
    - URL만 보고도 무슨 행동을 하는 API인지 명확하게 알 수 있음
    - 상태가 없기에 클라이언트와 서버의 역할이 명확히 분리됨
    - HTTP 표준을 사용하는 모든 플랫폼에서 사용할 수 있음
  - 단점
    - HTTP 메서드(GET, POST...)와 같은 방식의 개수에 제한이 있음
    - 설계를 하기 위해 공식적으로 제공되는 표준 규약이 없음

### REST API 설계 기본 규칙

- 도큐먼트: 객체 인스턴스나 데이터베이스 레코드와 유사한 개념
- 컬렉션: 서버에서 관리하는 디렉터리라는 리소스
- 스토어: 클라이언트에서 관리하는 리소스 저장소

1. URL은 정보의 자원을 표현해야 한다.
   - 자원은 가져오는 데이터
   - 자원은 동사보다는 명사를, 대문자보다는 소문자를 사용한다.
   - 자원의 도큐먼트 이름으로는 단수 명사를 사용해야 한다.
   - 자원의 컬렉션 이름으로는 복수 명사를 사용해야 한다.
   - 자원의 스토어 이름으로는 복수 명사를 사용해야 한다.
     - 학생 중에 id가 1인 학생의 정보를 가져오는 URL
     - /students/1
2. 자원에 대한 행위는 HTTP Method로 표현한다.
   - URI에 HTTP Method가 들어가면 안된다.
   - URI에 행위에 대한 동사 표현이 들어가면 안된다.(CRUD 기능을 나타내는 것은 URI에 사용하지 않는다)
   - 경로 부분 중 변하는 부분은 유일한 값으로 대체한다

### REST API 설계 규칙

1. 슬래시 구분자(/)는 계층 관계를 나타내는데 사용한다.
   - restapi.example.com/houses/apartments
2. URI 마지막 문자로 슬래시(/)를 포함하지 않는다.
   - URI에 포함되는 모든 글자는 리소스의 유일한 식별자로 사용되어야 하며 URI가 다르다는 것은 리소스가 다르다는 것, 역으로 리소스가 다르면
   URI도 달라져야 함
   - 분명한 URI를 만들어 통신을 해야 하기 때문에 혼동을 주지 않도록 마지막에 슬래시를 사용하지 않는다.
3. 하이픈(-)은 URI 가독성을 높이는데 사용한다.
   - 불가피하게 긴 URI경로를 사용하게 된다면 하이픈을 사용해 가독성을 높인다.
4. 밑줄(_)은 URI에 사용하지 않는다.
   - 밑줄은 보기 어렵거나 밑줄 때문에 문자가 가려지기도 하므로 가독성을 위해 밑줄은 사용하지 않는다.
5. URI 경로에는 소문자가 적합하다.
   - URI 경로에 대문자 사용은 피한다.
   - RFC 3986(URI 문법 형식)은 URI 스키마와 호스트를 제외하고는 대소문자를 구별하도록 규정하기 때문
6. 파일확장자는 URI에 포함하지 않는다.
   - REST API에서는 메시지 바디 내용의 포맷을 나타내기 위한 파일 확장자를 URI 안에 포함시키지 않는다.
   - Accept Header를 사용한다
     - restapi.example.com/members/soccer/345/photo.jpg(X)
     - GET restapi.example.com/members/soccer/345/photo Accept: image/jpg(O)
7. 리소스 간에 연관 관계가 있는 경우
   - /리소스명/리소스 ID/관계가 있는 다른 리소스명
     - GET /users/{userId}/devices (일반적으로 소유'has' 관계를 표현할 때)